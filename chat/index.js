var _0x192e67=_0x3fbd;(function(_0x33fa97,_0x307e6d){var _0x498307=_0x3fbd,_0x18c997=_0x33fa97();while(!![]){try{var _0x2e385f=-parseInt(_0x498307(0x250))/0x1*(-parseInt(_0x498307(0x2ac))/0x2)+-parseInt(_0x498307(0x20d))/0x3*(-parseInt(_0x498307(0x19c))/0x4)+-parseInt(_0x498307(0x1ae))/0x5+-parseInt(_0x498307(0x26b))/0x6*(parseInt(_0x498307(0x222))/0x7)+-parseInt(_0x498307(0x279))/0x8+parseInt(_0x498307(0x1bf))/0x9*(-parseInt(_0x498307(0x1e6))/0xa)+parseInt(_0x498307(0x2ae))/0xb;if(_0x2e385f===_0x307e6d)break;else _0x18c997['push'](_0x18c997['shift']());}catch(_0x55f29e){_0x18c997['push'](_0x18c997['shift']());}}}(_0x24f3,0xeae18));const express=require(_0x192e67(0x208)),app=express();var os=require('os'),ip=require('ip'),fs=require('fs');function _0x3fbd(_0x156193,_0x42c0cb){var _0x24f38a=_0x24f3();return _0x3fbd=function(_0x3fbd40,_0x3374d0){_0x3fbd40=_0x3fbd40-0x191;var _0xdd68c9=_0x24f38a[_0x3fbd40];return _0xdd68c9;},_0x3fbd(_0x156193,_0x42c0cb);}const http=require(_0x192e67(0x24a)),https=require(_0x192e67(0x26d));var config=require(_0x192e67(0x2cd)),server=http[_0x192e67(0x19b)](app);if(config[_0x192e67(0x24e)][_0x192e67(0x1f4)]){var options={'key':fs['readFileSync'](config[_0x192e67(0x24e)][_0x192e67(0x2f5)]),'cert':fs[_0x192e67(0x1aa)](config[_0x192e67(0x24e)]['cert'])};server=https['createServer'](options,app);}const {Server}=require(_0x192e67(0x211)),io=new Server(server),mysql=require(_0x192e67(0x266)),admin=require(_0x192e67(0x2a8)),crypto=require(_0x192e67(0x19d)),{RtcTokenBuilder,RtmTokenBuilder,RtcRole,RtmRole}=require(_0x192e67(0x1b2));var apn=require(_0x192e67(0x1d9));const {v4:uuidv4}=require(_0x192e67(0x1e9)),STATUS_UNRECEIVED=0x1,STATUS_RECEIVED=0x2,STATUS_READ=0x3,STATUS_DELETED=0x0,CURRENT_STATUS_SEND=0x1,CURRENT_STATUS_DELIVERED=0x2,CURRENT_STATUS_SEEN=0x3,CHAT_ROOM_USER_STATUS_ACTIVE=0xa,CHAT_ROOM_USER_STATUS_REMOVED=0x2,CHAT_ROOM_USER_STATUS_LEFT=0x3,CHAT_ROOM_TYPE_PRIVATE=0x1,CHAT_ROOM_TYPE_GROUP=0x2,CHAT_ROOM_TYPE_OPEN=0x3,COMMON_NO=0x0,COMMON_YES=0x1,STATUS_LIVE_CALL_ONGOING=0x1,STATUS_LIVE_CALL_COMPLETED=0x2,STATUS_LIVE_CALL_BATTLE_PENDING=0x1,STATUS_LIVE_CALL_BATTLE_ACCEPTED=0x2,STATUS_LIVE_CALL_BATTLE_REJECTED=0x3,STATUS_LIVE_CALL_BATTLE_ONGOING=0x4,STATUS_LIVE_CALL_BATTLE_CANCELLED=0x5,STATUS_LIVE_CALL_BATTLE_COMPLETED=0xa,STATUS_LIVE_CALL_USER_ROLE_SUPER_HOST=0x1,STATUS_LIVE_CALL_USER_ROLE_USER=0x2,STATUS_LIVE_CALL_USER_ROLE_MODERATOR=0x2,STATUS_LIVE_CALL_BAN_TYPE_WHOLE_CALL=0x1,STATUS_LIVE_CALL_BAN_TYPE_TIME_PERIOD=0x2,STATUS_LIVE_CALL_ACTION_TYPE_BAN=0x1,STATUS_LIVE_CALL_ACTION_TYPE_UNBAN=0x2,STATUS_LIVE_CALL_ACTION_TYPE_ROLE_UPDATE=0x3,STORAGE_URL=config['storageUrl'];let db;var hostname=os[_0x192e67(0x1a6)]();console[_0x192e67(0x1fb)](hostname);var serviceAccount;hostname==_0x192e67(0x1dd)?db=mysql[_0x192e67(0x195)]({'host':config['db'][_0x192e67(0x272)][_0x192e67(0x1a8)],'user':config['db'][_0x192e67(0x272)][_0x192e67(0x198)],'password':config['db'][_0x192e67(0x272)][_0x192e67(0x27b)],'database':config['db']['dev'][_0x192e67(0x24c)]}):db=mysql[_0x192e67(0x195)]({'host':config['db'][_0x192e67(0x2aa)]['host'],'user':config['db'][_0x192e67(0x2aa)][_0x192e67(0x198)],'password':config['db'][_0x192e67(0x2aa)][_0x192e67(0x27b)],'database':config['db'][_0x192e67(0x2aa)][_0x192e67(0x24c)]});serviceAccount=require(_0x192e67(0x1fe)),admin['initializeApp']({'credential':admin['credential'][_0x192e67(0x218)](serviceAccount),'databaseURL':config[_0x192e67(0x212)][_0x192e67(0x213)]}),process['on'](_0x192e67(0x21a),_0x49833e=>console[_0x192e67(0x290)](_0x49833e[_0x192e67(0x1e8)])),db['connect'](function(_0x4c7d31){var _0x3687fe=_0x192e67;if(_0x4c7d31)console['log'](_0x4c7d31);console[_0x3687fe(0x1fb)]('dbConnected');let _0x18ee3d=_0x3687fe(0x1d0);db[_0x3687fe(0x1b3)](_0x18ee3d,function(_0x12513f,_0x144fbb,_0x14aad7){var _0x4cf606=_0x3687fe;if(_0x12513f)throw _0x12513f;var _0x575f6a=_0x144fbb[0x0][_0x4cf606(0x265)],_0x5d8f62=_0x144fbb[0x0][_0x4cf606(0x30d)],_0x4f94c0=ip[_0x4cf606(0x249)](),_0x29776e='?purchase_code='+_0x575f6a+'&site_url='+_0x5d8f62+_0x4cf606(0x2ea)+_0x4f94c0,_0x56b6ef=_0x4cf606(0x1ff),_0x2fbde0={'_keyStr':_0x4cf606(0x302),'encode':function(_0x415d0d){var _0x2a8a34=_0x4cf606,_0x4c2ebd='',_0x32e92c,_0x343c78,_0xdff6e9,_0xec46f8,_0x2c230b,_0x70675b,_0x1e5362,_0x5573d6=0x0;_0x415d0d=_0x2fbde0[_0x2a8a34(0x309)](_0x415d0d);while(_0x5573d6<_0x415d0d[_0x2a8a34(0x1e4)]){_0x32e92c=_0x415d0d[_0x2a8a34(0x1a1)](_0x5573d6++),_0x343c78=_0x415d0d['charCodeAt'](_0x5573d6++),_0xdff6e9=_0x415d0d['charCodeAt'](_0x5573d6++),_0xec46f8=_0x32e92c>>0x2,_0x2c230b=(_0x32e92c&0x3)<<0x4|_0x343c78>>0x4,_0x70675b=(_0x343c78&0xf)<<0x2|_0xdff6e9>>0x6,_0x1e5362=_0xdff6e9&0x3f;if(isNaN(_0x343c78))_0x70675b=_0x1e5362=0x40;else isNaN(_0xdff6e9)&&(_0x1e5362=0x40);_0x4c2ebd=_0x4c2ebd+this['_keyStr']['charAt'](_0xec46f8)+this[_0x2a8a34(0x22e)][_0x2a8a34(0x22d)](_0x2c230b)+this[_0x2a8a34(0x22e)][_0x2a8a34(0x22d)](_0x70675b)+this[_0x2a8a34(0x22e)][_0x2a8a34(0x22d)](_0x1e5362);}return _0x4c2ebd;},'decode':function(_0x2506f1){var _0x59398c=_0x4cf606,_0x1c5278='',_0x27c752,_0x419549,_0x23ec0c,_0x1448ef,_0x433b5f,_0x57de3d,_0x15c174,_0x31cc57=0x0;_0x2506f1=_0x2506f1[_0x59398c(0x275)](/[^A-Za-z0-9+/=]/g,'');while(_0x31cc57<_0x2506f1[_0x59398c(0x1e4)]){_0x1448ef=this['_keyStr'][_0x59398c(0x1d7)](_0x2506f1['charAt'](_0x31cc57++)),_0x433b5f=this['_keyStr'][_0x59398c(0x1d7)](_0x2506f1[_0x59398c(0x22d)](_0x31cc57++)),_0x57de3d=this[_0x59398c(0x22e)]['indexOf'](_0x2506f1['charAt'](_0x31cc57++)),_0x15c174=this[_0x59398c(0x22e)][_0x59398c(0x1d7)](_0x2506f1[_0x59398c(0x22d)](_0x31cc57++)),_0x27c752=_0x1448ef<<0x2|_0x433b5f>>0x4,_0x419549=(_0x433b5f&0xf)<<0x4|_0x57de3d>>0x2,_0x23ec0c=(_0x57de3d&0x3)<<0x6|_0x15c174,_0x1c5278=_0x1c5278+String[_0x59398c(0x2d9)](_0x27c752),_0x57de3d!=0x40&&(_0x1c5278=_0x1c5278+String[_0x59398c(0x2d9)](_0x419549)),_0x15c174!=0x40&&(_0x1c5278=_0x1c5278+String[_0x59398c(0x2d9)](_0x23ec0c));}return _0x1c5278=_0x2fbde0['_utf8_decode'](_0x1c5278),_0x1c5278;},'_utf8_encode':function(_0x106300){var _0x2a4818=_0x4cf606;_0x106300=_0x106300[_0x2a4818(0x275)](/rn/g,'n');var _0x56b491='';for(var _0xcc6cd5=0x0;_0xcc6cd5<_0x106300[_0x2a4818(0x1e4)];_0xcc6cd5++){var _0x318d06=_0x106300[_0x2a4818(0x1a1)](_0xcc6cd5);if(_0x318d06<0x80)_0x56b491+=String[_0x2a4818(0x2d9)](_0x318d06);else _0x318d06>0x7f&&_0x318d06<0x800?(_0x56b491+=String[_0x2a4818(0x2d9)](_0x318d06>>0x6|0xc0),_0x56b491+=String[_0x2a4818(0x2d9)](_0x318d06&0x3f|0x80)):(_0x56b491+=String[_0x2a4818(0x2d9)](_0x318d06>>0xc|0xe0),_0x56b491+=String['fromCharCode'](_0x318d06>>0x6&0x3f|0x80),_0x56b491+=String['fromCharCode'](_0x318d06&0x3f|0x80));}return _0x56b491;},'_utf8_decode':function(_0x2ee600){var _0x20d8b2=_0x4cf606,_0x423f0e='',_0x2a0e7c=0x0,_0x3fe6a0=c1=c2=0x0;while(_0x2a0e7c<_0x2ee600[_0x20d8b2(0x1e4)]){_0x3fe6a0=_0x2ee600[_0x20d8b2(0x1a1)](_0x2a0e7c);if(_0x3fe6a0<0x80)_0x423f0e+=String[_0x20d8b2(0x2d9)](_0x3fe6a0),_0x2a0e7c++;else _0x3fe6a0>0xbf&&_0x3fe6a0<0xe0?(c2=_0x2ee600[_0x20d8b2(0x1a1)](_0x2a0e7c+0x1),_0x423f0e+=String[_0x20d8b2(0x2d9)]((_0x3fe6a0&0x1f)<<0x6|c2&0x3f),_0x2a0e7c+=0x2):(c2=_0x2ee600[_0x20d8b2(0x1a1)](_0x2a0e7c+0x1),c3=_0x2ee600[_0x20d8b2(0x1a1)](_0x2a0e7c+0x2),_0x423f0e+=String['fromCharCode']((_0x3fe6a0&0xf)<<0xc|(c2&0x3f)<<0x6|c3&0x3f),_0x2a0e7c+=0x3);}return _0x423f0e;}},_0x56b6ef=_0x2fbde0[_0x4cf606(0x1f7)](_0x56b6ef);_0x56b6ef=_0x56b6ef+_0x29776e,$serverInner=server,https[_0x4cf606(0x1c7)](_0x56b6ef,function(_0x1fb071){var _0xd362ad=_0x4cf606,_0x4a4e2b='';_0x1fb071['statusCode']==0xc8&&(_0x1fb071['on'](_0xd362ad(0x2d3),function(_0x6bf862){_0x4a4e2b+=_0x6bf862;}),_0x1fb071['on'](_0xd362ad(0x1d6),function(){var _0x4249bc=_0xd362ad,_0x2b3b72=JSON['parse'](_0x4a4e2b);_0x2b3b72['data'][_0x4249bc(0x31d)]==_0x4249bc(0x2fe)&&($serverInner['close'](),console[_0x4249bc(0x1fb)](_0x4249bc(0x22a),_0x2b3b72[_0x4249bc(0x1f6)]));}));})['on'](_0x4cf606(0x2ca),function(_0x5e2301){});});}),app['get']('/',(_0x359a26,_0x3f1394)=>{var _0x311c77=_0x192e67;_0x3f1394[_0x311c77(0x2dc)](__dirname+_0x311c77(0x2a3));}),app[_0x192e67(0x1c7)](_0x192e67(0x1b0),async(_0x2291c4,_0x24a4ef)=>{var _0x13ec92=_0x192e67,_0x354d79=await createToken();_0x24a4ef['end'](JSON[_0x13ec92(0x274)](_0x354d79));}),app[_0x192e67(0x1c7)]('/voiptest',(_0x3f132a,_0x14c96b)=>{var _0x46a81c=_0x192e67;let _0x4a6e97=_0x46a81c(0x2ce);var _0x40a9b3={'token':{'key':config['voipNotification']['key'],'keyId':config[_0x46a81c(0x2e2)][_0x46a81c(0x207)],'teamId':config['voipNotification'][_0x46a81c(0x199)]},'production':![]},_0x27e998=new apn[(_0x46a81c(0x2c1))](_0x40a9b3),_0x350e5c=new apn[(_0x46a81c(0x192))](),_0x2d8416=0x2,_0x497b60=0x2,_0xb3f3f1=_0x46a81c(0x307),_0x2a61cd=_0x46a81c(0x1ce),_0x2a5dfb=0x2,_0x32747a=_0x46a81c(0x269),_0x44162c=_0x46a81c(0x323);const _0x139686=uuidv4();var _0x32016a={'id':_0x2d8416,'callType':_0x497b60,'username':_0xb3f3f1,'userImage':_0x2a61cd,'callerId':_0x2a5dfb,'channelName':_0x32747a,'token':_0x44162c,'uuid':_0x139686};_0x350e5c[_0x46a81c(0x21e)]=Math[_0x46a81c(0x2dd)](Date['now']()/0x3e8)+0xe10,_0x350e5c[_0x46a81c(0x244)]=0x3,_0x350e5c[_0x46a81c(0x20f)]=_0x46a81c(0x235),_0x350e5c['alert']=_0x46a81c(0x19e),_0x350e5c[_0x46a81c(0x205)]=_0x32016a,_0x350e5c[_0x46a81c(0x285)]=config[_0x46a81c(0x2e2)]['bundleId']+_0x46a81c(0x292),_0x27e998[_0x46a81c(0x1b6)](_0x350e5c,_0x4a6e97)[_0x46a81c(0x246)]((_0x59e0b6,_0x42898c)=>{var _0x475fee=_0x46a81c;console[_0x475fee(0x1fb)](_0x42898c),_0x59e0b6?(console[_0x475fee(0x1fb)](JSON[_0x475fee(0x274)](_0x59e0b6)),_0x14c96b[_0x475fee(0x1d6)](JSON[_0x475fee(0x274)](_0x59e0b6))):(console[_0x475fee(0x1fb)](JSON[_0x475fee(0x274)](_0x42898c)),_0x14c96b[_0x475fee(0x1d6)](JSON[_0x475fee(0x274)](_0x42898c)));});}),io['on'](_0x192e67(0x2de),function(_0x3d7d4c){var _0x3f89ec=_0x192e67;console[_0x3f89ec(0x1fb)](_0x3f89ec(0x2db),_0x3d7d4c['id']),_0x3d7d4c['on'](_0x3f89ec(0x28c),_0x4b0bc9=>{var _0x159f5d=_0x3f89ec;console[_0x159f5d(0x1fb)]('UserLogin',_0x4b0bc9['userId'],_0x3d7d4c['id']),console[_0x159f5d(0x1fb)](_0x4b0bc9),_0x3d7d4c[_0x159f5d(0x201)]=_0x4b0bc9[_0x159f5d(0x201)],_0x3d7d4c[_0x159f5d(0x23b)]=_0x4b0bc9[_0x159f5d(0x23b)];let _0x56f16a=Math[_0x159f5d(0x293)](new Date()[_0x159f5d(0x31f)]()/0x3e8),_0x570e8b=_0x159f5d(0x301)+_0x3d7d4c['id']+_0x159f5d(0x259)+_0x56f16a+_0x159f5d(0x239)+COMMON_YES+'\x27\x20\x20where\x20id\x20=\x20'+_0x4b0bc9['userId'];db[_0x159f5d(0x1b3)](_0x570e8b,function(_0x414fb1,_0x4955d8,_0x1a438f){var _0x5cc054=_0x159f5d;if(_0x414fb1)throw _0x414fb1;let _0xab8626='SELECT\x20*\x20FROM\x20chat_room_user\x20where\x20user_id\x20='+_0x4b0bc9[_0x5cc054(0x23b)];db['query'](_0xab8626,function(_0x33953c,_0xd003be,_0x1d7202){var _0x5c5aa6=_0x5cc054;if(_0x33953c)throw _0x33953c;_0xd003be[_0x5c5aa6(0x2da)](_0x3e49c4=>{var _0x4f05ed=_0x5c5aa6;_0x3d7d4c[_0x4f05ed(0x248)](_0x3e49c4['room_id']),_0x3d7d4c['to'](_0x3e49c4[_0x4f05ed(0x2ab)])[_0x4f05ed(0x1e1)](_0x4f05ed(0x1f2),{'username':_0x3d7d4c[_0x4f05ed(0x201)],'userId':_0x3d7d4c[_0x4f05ed(0x23b)],'room':_0x3e49c4[_0x4f05ed(0x2ab)]});});});});var _0x53b24c='SELECT\x20chat_message_user.id\x20as\x20chat_message_user_id\x20,chat_message_user.chat_message_id,chat_message_user.status,\x20user.socket_id,\x20sender_user.id\x20as\x20sender_user_id,sender_user.username,\x20sender_user.socket_id\x20as\x20sender_socket_id,\x20chat_message.*\x20\x20\x20FROM\x20chat_message_user\x20left\x20join\x20chat_message\x20on\x20chat_message.id\x20=\x20chat_message_user.chat_message_id\x20LEFT\x20JOIN\x20user\x20on\x20chat_message_user.user_id\x20=\x20user.id\x20LEFT\x20JOIN\x20user\x20as\x20sender_user\x20on\x20chat_message.created_by\x20=\x20sender_user.id\x20\x20where\x20chat_message_user.user_id\x20='+_0x4b0bc9[_0x159f5d(0x23b)]+_0x159f5d(0x288)+STATUS_UNRECEIVED+_0x159f5d(0x2b5)+STATUS_DELETED;db[_0x159f5d(0x1b3)](_0x53b24c,function(_0x220065,_0x18ddd3,_0x371038){var _0x524b0b=_0x159f5d;if(_0x220065)throw _0x220065;_0x18ddd3['length']&&_0x18ddd3[_0x524b0b(0x2da)](_0x434be4=>{var _0x3c1301=_0x524b0b,_0x529598=COMMON_NO,_0x576b2a=STATUS_RECEIVED;if(_0x434be4[_0x3c1301(0x273)]>0x0&&_0x56f16a>_0x434be4['delete_time'])db[_0x3c1301(0x1b3)]('update\x20chat_message\x20set\x20status=\x27'+STATUS_DELETED+_0x3c1301(0x319)+_0x434be4['id'],function(_0x30758a,_0x4e4bd6,_0x12e66d){var _0x5a59ab=_0x3c1301;db[_0x5a59ab(0x1b3)](_0x5a59ab(0x245)+STATUS_DELETED+'\x27,is_user_notify=1\x20where\x20chat_message_id\x20='+_0x434be4['id'],function(_0x3893c5,_0x173f9e,_0x42fb18){});});else{var _0xe11354=_0x434be4[_0x3c1301(0x201)];io['to'](_0x434be4[_0x3c1301(0x30c)])[_0x3c1301(0x1e1)]('sendMessage',{'id':_0x434be4['id'],'localMessageId':_0x434be4['local_message_id'],'room':_0x434be4[_0x3c1301(0x2ab)],'messageType':_0x434be4[_0x3c1301(0x232)],'message':_0x434be4[_0x3c1301(0x1f6)],'replied_on_message':_0x434be4['replied_on_message'],'created_at':_0x434be4[_0x3c1301(0x24b)],'created_by':_0x434be4[_0x3c1301(0x298)],'username':_0xe11354,'is_encrypted':_0x434be4[_0x3c1301(0x1e7)],'chat_version':_0x434be4[_0x3c1301(0x30f)]});var _0x190567=io[_0x3c1301(0x2d0)][_0x3c1301(0x2d0)][_0x3c1301(0x1c7)](_0x434be4['sender_socket_id']);_0x190567&&(io['to'](_0x434be4[_0x3c1301(0x236)])[_0x3c1301(0x1e1)]('updateMessageCurrentStatusUser',{'id':_0x434be4['id'],'status':STATUS_RECEIVED,'messageId':_0x434be4['id'],'localMessageId':_0x434be4[_0x3c1301(0x19a)],'room':_0x434be4['room_id'],'userId':_0x3d7d4c['userId']}),_0x529598=COMMON_YES),db[_0x3c1301(0x1b3)](_0x3c1301(0x245)+STATUS_RECEIVED+_0x3c1301(0x2f8)+_0x529598+'\x27\x20where\x20id\x20='+_0x434be4[_0x3c1301(0x253)],function(_0x4bfce4,_0xa4750e,_0x13d268){});}});});var _0x53b24c=_0x159f5d(0x1ec)+_0x4b0bc9['userId']+_0x159f5d(0x2a4)+STATUS_DELETED;db[_0x159f5d(0x1b3)](_0x53b24c,function(_0x561bc6,_0x1442c0,_0x45816f){var _0x18fa2c=_0x159f5d;if(_0x561bc6)throw _0x561bc6;console[_0x18fa2c(0x1fb)](_0x1442c0),_0x1442c0[_0x18fa2c(0x1e4)]&&_0x1442c0['forEach'](_0x661a6c=>{var _0x2f1e26=_0x18fa2c,_0x3703dd=_0x661a6c[_0x2f1e26(0x201)];console[_0x2f1e26(0x1fb)](_0x2f1e26(0x224)+_0x3703dd);var _0x29552b={'id':_0x661a6c[_0x2f1e26(0x1e2)],'username':_0x3703dd,'room':_0x661a6c[_0x2f1e26(0x2ab)],'deleteScope':0x2};_0x3d7d4c['emit']('deleteMessage',_0x29552b);var _0x3e9623=0x1;db[_0x2f1e26(0x1b3)](_0x2f1e26(0x22b)+_0x3e9623+_0x2f1e26(0x319)+_0x661a6c['chat_message_user_id'],function(_0x4b85c5,_0x925dff,_0x837c52){});});});var _0x53b24c=_0x159f5d(0x209)+_0x4b0bc9[_0x159f5d(0x23b)]+'\x20and\x20chat_message_user.is_user_notify='+COMMON_NO+_0x159f5d(0x2b5)+STATUS_DELETED;;db[_0x159f5d(0x1b3)](_0x53b24c,function(_0x2a58a2,_0x528c90,_0x5ff3e4){var _0x45a4a7=_0x159f5d;if(_0x2a58a2)throw _0x2a58a2;var _0xcab3ff=[];_0x528c90[_0x45a4a7(0x2da)](_0x501059=>{var _0x140ba8=_0x45a4a7;_0xcab3ff[_0x140ba8(0x2a6)](_0x501059['chat_message_user_id']),_0x3d7d4c[_0x140ba8(0x1e1)](_0x140ba8(0x2a5),{'id':_0x501059['id'],'status':_0x501059[_0x140ba8(0x229)],'messageId':_0x501059[_0x140ba8(0x1e2)],'localMessageId':_0x501059[_0x140ba8(0x19a)],'room':_0x501059['room_id'],'userId':_0x501059['user_id']});}),_0xcab3ff[_0x45a4a7(0x1e4)]&&db[_0x45a4a7(0x1b3)]('update\x20chat_message_user\x20set\x20is_user_notify=\x27'+COMMON_YES+_0x45a4a7(0x29b)+_0xcab3ff+')',function(_0x1e8fe0,_0x4b0546,_0xf7c554){});});}),_0x3d7d4c['on'](_0x3f89ec(0x1ab),_0x5f4955=>{var _0x7b669f=_0x3f89ec;console[_0x7b669f(0x1fb)](_0x5f4955);var _0x2f0aae=_0x5f4955[_0x7b669f(0x2e6)];usernameActiondBy=_0x3d7d4c[_0x7b669f(0x201)];var _0x251f63=_0x3d7d4c[_0x7b669f(0x23b)],_0x6c5853=Math[_0x7b669f(0x293)](new Date()['getTime']()/0x3e8),_0x2b0106='SELECT\x20*\x20FROM\x20chat_room\x20where\x20id\x20=\x20'+db[_0x7b669f(0x203)](_0x2f0aae);db[_0x7b669f(0x1b3)](_0x2b0106,function(_0xbf8cf1,_0x1ca390,_0x278a38){var _0x4772b6=_0x7b669f;if(_0xbf8cf1)throw _0xbf8cf1;var _0x4a9877=0x0,_0xa2e940=0x0;_0x1ca390[_0x4772b6(0x1e4)]&&(_0x4a9877=_0x1ca390[0x0]['created_by'],_0xa2e940=_0x1ca390[0x0][_0x4772b6(0x232)]),db[_0x4772b6(0x1b3)](_0x4772b6(0x219)+_0x5f4955['userId']+')',function(_0x384a47,_0x1580b6,_0x3c482c){if(_0x384a47)throw _0x384a47;_0x1580b6['forEach'](_0x472dd9=>{var _0x52fd5a=_0x3fbd;db[_0x52fd5a(0x1b3)](_0x52fd5a(0x1a9)+_0x472dd9['id']+_0x52fd5a(0x2a2)+_0x2f0aae+_0x52fd5a(0x303),function(_0x3e8f5c,_0x36a218,_0x487114){var _0x588b6e=_0x52fd5a;if(!_0x36a218['length']){var _0x373b95=0x0;if(_0x472dd9['id']==_0x4a9877)var _0x373b95=0x1;var _0x1758a8='INSERT\x20INTO\x20chat_room_user\x20(room_id,\x20user_id,is_admin,created_at,created_by)\x20VALUES\x20('+db[_0x588b6e(0x203)](_0x2f0aae)+','+db[_0x588b6e(0x203)](_0x472dd9['id'])+','+db['escape'](_0x373b95)+','+db[_0x588b6e(0x203)](_0x6c5853)+','+db[_0x588b6e(0x203)](_0x251f63)+'\x20)';db['query'](_0x1758a8,function(_0x5bdfa8,_0x23da7a){var _0x4b9687=_0x588b6e;if(_0x5bdfa8)throw _0x5bdfa8;if(_0xa2e940==CHAT_ROOM_TYPE_GROUP||_0xa2e940==CHAT_ROOM_TYPE_OPEN){var _0x372328={'userId':_0x472dd9['id'],'username':_0x472dd9[_0x4b9687(0x201)],'room':_0x2f0aae,'usernameActiondBy':usernameActiondBy,'userIdActiondBy':_0x251f63,'created_at':_0x6c5853};io['to'](_0x2f0aae)[_0x4b9687(0x1e1)]('addUser',_0x372328);}var _0x37ebc8=_0x472dd9[_0x4b9687(0x30c)],_0x2bf97d=io[_0x4b9687(0x2d0)][_0x4b9687(0x2d0)]['get'](_0x37ebc8);_0x2bf97d&&_0x2bf97d[_0x4b9687(0x248)](_0x2f0aae);});}});});});});}),_0x3d7d4c['on'](_0x3f89ec(0x2f2),_0xd7c4d6=>{var _0x2bb7ec=_0x3f89ec;console[_0x2bb7ec(0x1fb)](_0x2bb7ec(0x30b)),username=_0x3d7d4c[_0x2bb7ec(0x201)];var _0x1fa039=_0x3d7d4c[_0x2bb7ec(0x23b)],_0x182594=_0xd7c4d6['room'],_0x3a5471=Math[_0x2bb7ec(0x293)](new Date()[_0x2bb7ec(0x31f)]()/0x3e8),_0x31f90b=_0x2bb7ec(0x1ea)+CHAT_ROOM_USER_STATUS_LEFT+_0x2bb7ec(0x25f)+db[_0x2bb7ec(0x203)](_0x1fa039)+_0x2bb7ec(0x1c0)+db[_0x2bb7ec(0x203)](_0x182594);db[_0x2bb7ec(0x1b3)](_0x31f90b,function(_0x518740,_0x5bb6f4,_0xb093b4){var _0x33656b=_0x2bb7ec,_0x5582d6={'userId':_0x1fa039,'username':username,'room':_0x182594,'created_at':_0x3a5471};io['to'](_0x182594)[_0x33656b(0x1e1)](_0x33656b(0x2f2),_0x5582d6),_0x3d7d4c['leave'](_0x182594);});}),_0x3d7d4c['on'](_0x3f89ec(0x1d1),_0x28c4e0=>{var _0x541945=_0x3f89ec;console[_0x541945(0x1fb)]('removeUserFromRoom'),usernameActiondBy=_0x3d7d4c[_0x541945(0x201)];var _0x2379c1=_0x3d7d4c[_0x541945(0x23b)],_0x701696=_0x28c4e0['userId'],_0x4b08d9=_0x28c4e0[_0x541945(0x2e6)],_0x518697=Math[_0x541945(0x293)](new Date()[_0x541945(0x31f)]()/0x3e8);db[_0x541945(0x1b3)](_0x541945(0x240)+db[_0x541945(0x203)](_0x701696),function(_0x22eee5,_0x20a20f,_0x570aa0){var _0x1671ea=_0x541945;if(_0x20a20f){if(_0x20a20f[_0x1671ea(0x1e4)]){var _0x4526fd=_0x20a20f[0x0][_0x1671ea(0x201)],_0x4b7c81=_0x1671ea(0x1ea)+CHAT_ROOM_USER_STATUS_REMOVED+_0x1671ea(0x25f)+db[_0x1671ea(0x203)](_0x701696)+_0x1671ea(0x1c0)+db[_0x1671ea(0x203)](_0x4b08d9);db[_0x1671ea(0x1b3)](_0x4b7c81,function(_0x4085ab,_0x236026,_0x382ce5){var _0x29e116=_0x1671ea,_0x2e160a={'userId':_0x701696,'username':_0x4526fd,'room':_0x4b08d9,'usernameActiondBy':usernameActiondBy,'userIdActiondBy':_0x2379c1,'created_at':_0x518697};io['to'](_0x4b08d9)['emit'](_0x29e116(0x1d1),_0x2e160a);var _0x76c7bf=_0x20a20f[0x0][_0x29e116(0x30c)],_0xfb7237=io[_0x29e116(0x2d0)][_0x29e116(0x2d0)][_0x29e116(0x1c7)](_0x76c7bf);_0xfb7237&&_0xfb7237['leave'](_0x4b08d9);});}}});}),_0x3d7d4c['on'](_0x3f89ec(0x305),_0x39dd15=>{var _0x202deb=_0x3f89ec;console['log'](_0x202deb(0x305)),usernameActiondBy=_0x3d7d4c[_0x202deb(0x201)];var _0x1afb3e=_0x3d7d4c[_0x202deb(0x23b)],_0x424fab=_0x39dd15[_0x202deb(0x23b)],_0x2ed797=_0x39dd15[_0x202deb(0x2e6)],_0x494f26=Math[_0x202deb(0x293)](new Date()[_0x202deb(0x31f)]()/0x3e8);db['query'](_0x202deb(0x240)+db[_0x202deb(0x203)](_0x424fab),function(_0x5be087,_0x2928a0,_0x48b8f1){var _0xe87636=_0x202deb;if(_0x2928a0){if(_0x2928a0[_0xe87636(0x1e4)]){var _0x1224f7=_0x2928a0[0x0]['username'],_0x244704='update\x20chat_room_user\x20set\x20is_admin=1\x20where\x20user_id\x20=\x20'+db[_0xe87636(0x203)](_0x424fab)+_0xe87636(0x1c0)+db['escape'](_0x2ed797);db['query'](_0x244704,function(_0x235630,_0x27c00c,_0x575282){var _0x4a6a31=_0xe87636,_0x439ffe={'userId':_0x424fab,'username':_0x1224f7,'room':_0x2ed797,'usernameActiondBy':usernameActiondBy,'userIdActiondBy':_0x1afb3e,'created_at':_0x494f26};io['to'](_0x2ed797)['emit'](_0x4a6a31(0x305),_0x439ffe);});}}});}),_0x3d7d4c['on'](_0x3f89ec(0x1da),_0x1eb1ff=>{var _0x9274ca=_0x3f89ec;console[_0x9274ca(0x1fb)](_0x9274ca(0x1da)),usernameActiondBy=_0x3d7d4c['username'];var _0x295cf3=_0x3d7d4c[_0x9274ca(0x23b)],_0x25e442=_0x1eb1ff[_0x9274ca(0x23b)],_0x190d43=_0x1eb1ff[_0x9274ca(0x2e6)],_0x3803ba=Math[_0x9274ca(0x293)](new Date()[_0x9274ca(0x31f)]()/0x3e8);db['query'](_0x9274ca(0x240)+db[_0x9274ca(0x203)](_0x25e442),function(_0x2dc94f,_0x5657dd,_0x232c26){var _0x2a684a=_0x9274ca;if(_0x5657dd){if(_0x5657dd[_0x2a684a(0x1e4)]){var _0x230421=_0x5657dd[0x0][_0x2a684a(0x201)],_0x28bff3=_0x2a684a(0x299)+db[_0x2a684a(0x203)](_0x25e442)+_0x2a684a(0x1c0)+db[_0x2a684a(0x203)](_0x190d43);db[_0x2a684a(0x1b3)](_0x28bff3,function(_0x3bd26a,_0x350676,_0x396b12){var _0x26f0f8=_0x2a684a,_0x11b610={'userId':_0x25e442,'username':_0x230421,'room':_0x190d43,'usernameActiondBy':usernameActiondBy,'userIdActiondBy':_0x295cf3,'created_at':_0x3803ba};io['to'](_0x190d43)[_0x26f0f8(0x1e1)](_0x26f0f8(0x1da),_0x11b610);});}}});}),_0x3d7d4c['on'](_0x3f89ec(0x2c6),_0x54fdb5=>{var _0x503560=_0x3f89ec;console[_0x503560(0x1fb)]('updateChatAccessGroup'),usernameActiondBy=_0x3d7d4c['username'];var _0x4c6828=_0x3d7d4c[_0x503560(0x23b)],_0x3252e4=_0x54fdb5[_0x503560(0x2e6)],_0x40ef98=_0x54fdb5[_0x503560(0x233)],_0x157b03=Math['round'](new Date()['getTime']()/0x3e8),_0x17fd66=_0x503560(0x1a0)+db[_0x503560(0x203)](_0x40ef98)+_0x503560(0x1b1)+db[_0x503560(0x203)](_0x3252e4);db['query'](_0x17fd66,function(_0x2e79a1,_0x4453ed,_0xeb68a){var _0x172aaf={'room':_0x3252e4,'usernameActiondBy':usernameActiondBy,'userIdActiondBy':_0x4c6828,'chatAccessGroup':_0x40ef98,'created_at':_0x157b03};io['to'](_0x3252e4)['emit']('updateChatAccessGroup',_0x172aaf);});}),_0x3d7d4c['on'](_0x3f89ec(0x2f6),()=>{var _0x11ff3e=_0x3f89ec;try{let _0x3a6a6f=_0x3d7d4c[_0x11ff3e(0x201)],_0x440b02=_0x3d7d4c[_0x11ff3e(0x23b)];console[_0x11ff3e(0x1fb)](_0x11ff3e(0x322),_0x440b02,_0x3d7d4c['id']);if(_0x3d7d4c['userId']){let _0xcc5557=Math[_0x11ff3e(0x293)](new Date()[_0x11ff3e(0x31f)]()/0x3e8),_0xa5bd11='update\x20user\x20set\x20socket_id=NULL,chat_last_time_online=\x27'+_0xcc5557+_0x11ff3e(0x239)+COMMON_NO+_0x11ff3e(0x256)+db[_0x11ff3e(0x203)](_0x3d7d4c[_0x11ff3e(0x23b)]);db['query'](_0xa5bd11,function(_0x599e7a,_0x3a6c31,_0x422653){}),_0xa5bd11=_0x11ff3e(0x1a9)+_0x3d7d4c[_0x11ff3e(0x23b)],db['query'](_0xa5bd11,function(_0x33a468,_0x127121,_0x58efbe){var _0x14b7b1=_0x11ff3e;if(_0x33a468)throw _0x33a468;_0x127121[_0x14b7b1(0x2da)](_0x2fe1af=>{var _0x69eeda=_0x14b7b1;console[_0x69eeda(0x1fb)]('userOffline',_0x440b02),_0x3d7d4c['to'](_0x2fe1af[_0x69eeda(0x2ab)])[_0x69eeda(0x1e1)](_0x69eeda(0x297),{'username':_0x3a6a6f,'userId':_0x440b02,'room':_0x2fe1af['room_id']});});});var _0x8dc247={'userId':_0x440b02};endLiveCallIfExist(_0x3d7d4c,_0x8dc247);var _0x396505=_0x11ff3e(0x291)+db[_0x11ff3e(0x203)](_0x440b02);db[_0x11ff3e(0x1b3)](_0x396505,function(_0x1df9ea,_0x1952b3,_0x5c6baf){});var _0x396505='delete\x20from\x20live_call_viewer\x20\x20where\x20is_ban=0\x20and\x20user_id\x20=\x20'+db[_0x11ff3e(0x203)](_0x440b02);db[_0x11ff3e(0x1b3)](_0x396505,function(_0x10cdec,_0x1944b5,_0x411c1d){});}_0x3d7d4c['disconnect'](),_0x3d7d4c[_0x11ff3e(0x2f9)](),console[_0x11ff3e(0x1fb)](_0x11ff3e(0x27f));}catch(_0x33ff64){console['log'](_0x33ff64),console[_0x11ff3e(0x1fb)](_0x11ff3e(0x27d));}}),_0x3d7d4c['on'](_0x3f89ec(0x1d2),async _0x471eed=>{var _0x51d8e6=_0x3f89ec;try{_0x471eed[_0x51d8e6(0x201)]=_0x3d7d4c[_0x51d8e6(0x201)],_0x471eed[_0x51d8e6(0x24b)]=Math[_0x51d8e6(0x293)](new Date()[_0x51d8e6(0x31f)]()/0x3e8),_0x471eed[_0x51d8e6(0x298)]=_0x471eed[_0x51d8e6(0x23b)];var _0x32feca=_0x471eed['room'],_0x24e2eb=_0x471eed[_0x51d8e6(0x23b)],_0x856861=_0x51d8e6(0x318)+_0x32feca,_0x5cc339=await getDbData(_0x856861);if(_0x5cc339['length']){if(_0x5cc339[0x0][_0x51d8e6(0x232)]==0x1)for await(const _0x1598d6 of _0x5cc339){var _0x856861='SELECT\x20*\x20from\x20blocked_user\x20where\x20blocked_user_id\x20='+_0x24e2eb+_0x51d8e6(0x1af)+_0x1598d6[_0x51d8e6(0x2e7)],_0x32ffba=await getDbData(_0x856861);if(_0x32ffba[_0x51d8e6(0x1e4)])return![];}}var _0x47d4f8=0x0;_0x471eed['deleteAfter']>0x0&&(_0x47d4f8=_0x471eed[_0x51d8e6(0x24b)]+_0x471eed[_0x51d8e6(0x2ef)]);var _0x4c1902=_0x51d8e6(0x2d8)+db['escape'](_0x471eed[_0x51d8e6(0x28b)])+','+db['escape'](_0x471eed[_0x51d8e6(0x2e6)])+','+db['escape'](_0x471eed[_0x51d8e6(0x2fa)])+','+db['escape'](_0x471eed[_0x51d8e6(0x1f6)])+','+db[_0x51d8e6(0x203)](_0x471eed[_0x51d8e6(0x1ef)])+','+db[_0x51d8e6(0x203)](COMMON_YES)+','+db[_0x51d8e6(0x203)](_0x471eed['chat_version'])+','+db[_0x51d8e6(0x203)](_0x471eed[_0x51d8e6(0x23b)])+','+db[_0x51d8e6(0x203)](_0x471eed[_0x51d8e6(0x24b)])+','+db[_0x51d8e6(0x203)](_0x47d4f8)+'\x20)';db[_0x51d8e6(0x1b3)](_0x4c1902,function(_0x3b9455,_0x260241){var _0x2bffd3=_0x51d8e6;if(_0x3b9455)throw _0x3b9455;var _0x33bbc2=_0x260241[_0x2bffd3(0x1e5)];_0x471eed['id']=_0x33bbc2,_0x3d7d4c['to'](_0x32feca)[_0x2bffd3(0x1e1)]('sendMessage',_0x471eed),_0x3d7d4c['emit'](_0x2bffd3(0x1bc),{'current_status':CURRENT_STATUS_SEND,'id':_0x33bbc2,'localMessageId':_0x471eed['localMessageId'],'room':_0x32feca,'created_at':_0x471eed['created_at'],'userId':_0x3d7d4c[_0x2bffd3(0x23b)]}),db[_0x2bffd3(0x1b3)](_0x2bffd3(0x240)+db['escape'](_0x471eed['userId']),function(_0x242c39,_0x5d0743,_0x193e1c){var _0x93b86=_0x2bffd3;if(_0x5d0743){if(_0x5d0743['length']){var _0x5226e5=_0x5d0743[0x0][_0x93b86(0x2df)];_0x5226e5==null&&(_0x5226e5='default.png');var _0x359b94=STORAGE_URL+_0x93b86(0x29d)+_0x5226e5;_0x5226e5==null&&(_0x359b94=null),db[_0x93b86(0x1b3)](_0x93b86(0x318)+_0x32feca,function(_0x1bdbbb,_0x2f748e,_0x459943){var _0x19d289=_0x93b86;if(_0x2f748e[_0x19d289(0x1e4)]){var _0x4e4bd0=[],_0x3a49fd=![];_0x2f748e[_0x19d289(0x2da)](_0x5c8c30=>{var _0x236958=_0x19d289;console[_0x236958(0x1fb)](_0x5c8c30);var _0x646a80=_0x5c8c30[_0x236958(0x2e7)];_0x5c8c30[_0x236958(0x232)]==0x1&&(_0x5c8c30[_0x236958(0x229)]!=0xa&&db[_0x236958(0x1b3)]('update\x20chat_room_user\x20set\x20status=\x2710\x27\x20where\x20id\x20='+_0x5c8c30['id'],function(_0x2f5748,_0x7b82fa,_0x535ad7){}));var _0x22ffaa=io[_0x236958(0x2d0)][_0x236958(0x2d0)][_0x236958(0x1c7)](_0x5c8c30[_0x236958(0x30c)]),_0x2d3a55=STATUS_UNRECEIVED,_0x59d56f=0x0;if(_0x22ffaa)console[_0x236958(0x1fb)](_0x236958(0x1db)),_0x646a80!=_0x3d7d4c['userId']&&(_0x3a49fd=!![],_0x3d7d4c[_0x236958(0x1e1)](_0x236958(0x2a5),{'status':STATUS_RECEIVED,'messageId':_0x33bbc2,'localMessageId':_0x471eed[_0x236958(0x28b)],'room':_0x32feca,'userId':_0x646a80})),_0x2d3a55=STATUS_RECEIVED,_0x59d56f=0x1;else{console[_0x236958(0x1fb)](_0x236958(0x2e3));var _0x3d6124=_0x5c8c30['device_token'];if(_0x3d6124){if(_0x471eed[_0x236958(0x2fa)]!=_0x236958(0x2f1)&&_0x471eed[_0x236958(0x2fa)]!=_0x236958(0x315)){var _0xab8a9f=getMessageBody(_0x471eed),_0x294c57=_0xab8a9f[_0x236958(0x2c0)],_0x33a25a={'title':_0x471eed['username'],'body':_0x294c57,'notification_type':_0x236958(0x2f1),'room':_0x32feca[_0x236958(0x300)](),'userImageUrl':_0x359b94,'userId':_0x471eed[_0x236958(0x23b)][_0x236958(0x300)]()};_0xab8a9f[_0x236958(0x2df)]&&(_0x33a25a[_0x236958(0x2df)]=_0xab8a9f[_0x236958(0x2df)]),sendPushNotification(_0x3d6124,_0x33a25a);}}}_0x59d56f=0x1,_0x4e4bd0[_0x236958(0x2a6)]([_0x33bbc2,_0x646a80,_0x2d3a55,_0x59d56f]);});var _0x10e1c6='INSERT\x20INTO\x20chat_message_user\x20(chat_message_id,\x20user_id,\x20status,is_user_notify)\x20VALUES\x20?';db[_0x19d289(0x1b3)](_0x10e1c6,[_0x4e4bd0],function(_0x4aa709,_0x4458b3){if(_0x4aa709)throw _0x4aa709;});}});}}});});}catch(_0x37b8bf){console['log'](_0x37b8bf),console[_0x51d8e6(0x1fb)](_0x51d8e6(0x27d));}}),_0x3d7d4c['on'](_0x3f89ec(0x1fa),_0x5affb1=>{var _0x1b9490=_0x3f89ec;console[_0x1b9490(0x1fb)](_0x1b9490(0x268)),console[_0x1b9490(0x1fb)](_0x5affb1),db[_0x1b9490(0x1b3)](_0x1b9490(0x245)+STATUS_READ+_0x1b9490(0x2e1)+db[_0x1b9490(0x203)](_0x5affb1['id'])+_0x1b9490(0x26f)+db['escape'](_0x3d7d4c[_0x1b9490(0x23b)]),function(_0x37040f,_0x3bdc59,_0x5eb23c){var _0xbc209b=_0x1b9490;db['query'](_0xbc209b(0x1d3)+db[_0xbc209b(0x203)](_0x5affb1['id']),function(_0x31dc8f,_0x1b7e25,_0x2dffae){var _0x2ca8dd=_0xbc209b;if(_0x1b7e25){if(_0x1b7e25[_0x2ca8dd(0x1e4)]){var _0x435f12=_0x1b7e25[0x0][_0x2ca8dd(0x298)],_0x4b6927=_0x1b7e25[0x0]['created_at'],_0x4d9fdc=_0x1b7e25[0x0][_0x2ca8dd(0x19a)],_0x2411c6=_0x1b7e25[0x0]['room_id'];db[_0x2ca8dd(0x1b3)](_0x2ca8dd(0x20b)+db[_0x2ca8dd(0x203)](_0x435f12),function(_0x2a80ec,_0x408bea,_0x5d2750){var _0x19d466=_0x2ca8dd;if(_0x2a80ec)throw _0x2a80ec;if(_0x408bea){var _0x442d12=_0x408bea[0x0][_0x19d466(0x30c)],_0x20ef33=io['sockets'][_0x19d466(0x2d0)][_0x19d466(0x1c7)](_0x442d12),_0x44dbbb=COMMON_NO;_0x20ef33&&(console['log'](_0x19d466(0x1f5)),io['to'](_0x442d12)[_0x19d466(0x1e1)](_0x19d466(0x2a5),{'status':STATUS_READ,'messageId':_0x5affb1['id'],'localMessageId':_0x5affb1[_0x19d466(0x28b)],'room':_0x2411c6,'userId':_0x3d7d4c[_0x19d466(0x23b)]}),_0x44dbbb=COMMON_YES),db[_0x19d466(0x1b3)](_0x19d466(0x22b)+_0x44dbbb+'\x27\x20where\x20chat_message_id\x20=\x20'+db[_0x19d466(0x203)](_0x5affb1['id'])+'\x20and\x20user_id\x20=\x20'+db[_0x19d466(0x203)](_0x3d7d4c[_0x19d466(0x23b)]),function(_0x4318c6,_0x312a10,_0x21fb09){});}});}}});});}),_0x3d7d4c['on']('deleteMessage',async _0x1a7a90=>{var _0x149372=_0x3f89ec;console[_0x149372(0x1fb)]('delete\x20message'),username=_0x3d7d4c['username'];var _0x5b7b7c=_0x1a7a90['room'],_0x48ee57=_0x1a7a90['id'],_0x5e8c5b=_0x1a7a90[_0x149372(0x1d5)],_0x255dfe=_0x149372(0x1df)+db[_0x149372(0x203)](_0x48ee57);_0x5e8c5b==0x1&&(_0x255dfe=_0x255dfe+'\x20and\x20chat_message_user.user_id\x20=\x20'+db[_0x149372(0x203)](_0x3d7d4c[_0x149372(0x23b)]));var _0x2da330=await getDbData(_0x255dfe);if(_0x2da330[_0x149372(0x1e4)]){_0x2da330[_0x149372(0x2da)](_0x286248=>{var _0x578be1=_0x149372,_0x9405b8=io[_0x578be1(0x2d0)][_0x578be1(0x2d0)][_0x578be1(0x1c7)](_0x286248[_0x578be1(0x30c)]),_0x582c31=0x0;_0x9405b8&&(_0x582c31=0x1);var _0xab0111=_0x578be1(0x245)+STATUS_DELETED+_0x578be1(0x1bd)+_0x582c31+'\x27\x20where\x20id\x20=\x20'+db[_0x578be1(0x203)](_0x286248['id']);getDbData(_0xab0111);});var _0x4384be={'id':_0x48ee57,'username':username,'room':_0x5b7b7c,'deleteScope':_0x5e8c5b};if(_0x5e8c5b==0x2)_0x3d7d4c['to'](_0x5b7b7c)[_0x149372(0x1e1)](_0x149372(0x1c3),_0x4384be);else{}}}),_0x3d7d4c['on'](_0x3f89ec(0x1f8),_0x3e90b4=>{var _0x45dc70=_0x3f89ec;console[_0x45dc70(0x1fb)](_0x45dc70(0x2e5)),username=_0x3d7d4c['username'];var _0x2e8111=_0x3e90b4[_0x45dc70(0x2e6)],_0x259653=_0x3e90b4['id'],_0x3017fa=_0x3e90b4[_0x45dc70(0x1d5)],_0x54bbf9='update\x20chat_message_user\x20set\x20status=\x27'+STATUS_DELETED+_0x45dc70(0x2e1)+db[_0x45dc70(0x203)](_0x259653);_0x3017fa==0x1&&(_0x54bbf9=_0x54bbf9+_0x45dc70(0x26f)+db['escape'](_0x3d7d4c[_0x45dc70(0x23b)])),db[_0x45dc70(0x1b3)](_0x54bbf9,function(_0x3a68a0,_0x4ed4ee,_0x323f4d){var _0xe892c3=_0x45dc70;console['log'](_0x4ed4ee);var _0x5ac879={'id':_0x259653,'username':username,'room':_0x2e8111,'deleteScope':_0x3017fa};if(_0x3017fa==0x2)_0x3d7d4c['to'](_0x2e8111)[_0xe892c3(0x1e1)](_0xe892c3(0x1c3),_0x5ac879);else{}});}),_0x3d7d4c['on'](_0x3f89ec(0x2c2),_0x2fffbb=>{var _0x5cc875=_0x3f89ec;console[_0x5cc875(0x1fb)](_0x5cc875(0x2c2)),_0x3d7d4c['to'](_0x2fffbb[_0x5cc875(0x2e6)])['emit'](_0x5cc875(0x2c2),{'username':_0x3d7d4c[_0x5cc875(0x201)],'room':_0x2fffbb[_0x5cc875(0x2e6)]});}),_0x3d7d4c['on'](_0x3f89ec(0x2b7),async _0x2defe8=>{var _0x103755=_0x3f89ec,_0x32f796=_0x2defe8[_0x103755(0x23b)],_0xd8e470=_0x2defe8[_0x103755(0x1c8)],_0x2c17c6=_0x2defe8['callType'],_0x3440f0=_0x2defe8[_0x103755(0x1fc)],_0xabe601,_0xde759d=await createToken(),_0xabe601=_0xde759d[_0x103755(0x271)],_0x1cfa04=_0xde759d['token'],_0x1d93c9=uuidv4(),_0x36e51f=Math[_0x103755(0x293)](new Date()[_0x103755(0x31f)]()/0x3e8),_0x3a5fa7=_0x103755(0x263)+db['escape'](_0x1d93c9)+','+db['escape'](_0x3440f0)+','+db[_0x103755(0x203)](_0x2c17c6)+','+db['escape'](_0x32f796)+','+db[_0x103755(0x203)](_0xd8e470)+','+db[_0x103755(0x203)](_0x36e51f)+','+db['escape'](_0xabe601)+'\x20)';db[_0x103755(0x1b3)](_0x3a5fa7,function(_0x2d7da1,_0x371d0c){var _0x13a8dc=_0x103755;if(_0x2d7da1)throw _0x2d7da1;var _0x59b006=_0x371d0c['insertId'];db[_0x13a8dc(0x1b3)](_0x13a8dc(0x240)+db[_0x13a8dc(0x203)](_0x32f796),function(_0x5ad9ee,_0x3e6eca,_0x2ddf13){var _0x56bb73=_0x13a8dc;if(_0x3e6eca){if(_0x3e6eca[_0x56bb73(0x1e4)]){var _0x4e933f=_0x3e6eca[0x0]['image'],_0x4662a2=STORAGE_URL+_0x56bb73(0x29d)+_0x4e933f;_0x4e933f==null&&(_0x4662a2=null),db[_0x56bb73(0x1b3)](_0x56bb73(0x260)+db[_0x56bb73(0x203)](_0xd8e470),function(_0x13a61e,_0x4186c1,_0x3b122c){var _0x46ca49=_0x56bb73;if(_0x13a61e)throw _0x13a61e;if(_0x4186c1){var _0x162207={'id':_0x59b006[_0x46ca49(0x300)](),'callType':_0x2c17c6[_0x46ca49(0x300)](),'username':_0x3d7d4c['username'],'userImage':_0x4662a2,'callerId':_0x32f796[_0x46ca49(0x300)](),'channelName':_0xabe601,'token':_0x1cfa04,'uuid':_0x1d93c9};io['to'](_0x4186c1[0x0]['socket_id'])[_0x46ca49(0x1e1)](_0x46ca49(0x231),_0x162207),_0x162207[_0x46ca49(0x1cd)]=_0x46ca49(0x2b6);if(_0x4186c1[0x0][_0x46ca49(0x1dc)]==0x1){var _0x5e8b34=_0x4186c1[0x0][_0x46ca49(0x316)];_0x162207[_0x46ca49(0x21c)]=_0x3d7d4c[_0x46ca49(0x201)],_0x162207[_0x46ca49(0x320)]=_0x46ca49(0x1ba),sendPushNotification(_0x5e8b34,_0x162207);}else{let _0x20cfe0=_0x4186c1[0x0][_0x46ca49(0x1e0)];_0x20cfe0&&sendIosVoipPushNotification(_0x20cfe0,_0x162207);}}});}}}),_0x3d7d4c['emit']('callCreateConfirm',{'id':_0x59b006,'callType':_0x2c17c6,'localCallId':_0x3440f0,'channelName':_0xabe601,'token':_0x1cfa04,'uuid':_0x1d93c9});});}),_0x3d7d4c['on'](_0x3f89ec(0x1ee),_0x42f3ee=>{var _0x5870cf=_0x3f89ec,_0x3a519c=_0x42f3ee[_0x5870cf(0x23b)],_0x1b79cc=_0x42f3ee[_0x5870cf(0x1e9)],_0x1de42f=_0x42f3ee['status'];console[_0x5870cf(0x1fb)](_0x42f3ee);var _0x1bbb03=Math[_0x5870cf(0x293)](new Date()['getTime']()/0x3e8);db['query'](_0x5870cf(0x27a)+db[_0x5870cf(0x203)](_0x1b79cc),function(_0x35a460,_0x209c08,_0x49dd78){var _0x5f343a=_0x5870cf;console[_0x5f343a(0x1fb)](_0x209c08);if(_0x209c08){if(_0x209c08[_0x5f343a(0x1e4)]){var _0x2c3512=_0x209c08[0x0][_0x5f343a(0x313)],_0x352b8b=_0x209c08[0x0][_0x5f343a(0x1a2)],_0x41e147=_0x209c08[0x0][_0x5f343a(0x26e)],_0x3f929a=_0x209c08[0x0]['channel_name'],_0x27b635=_0x209c08[0x0]['uuid'],_0x15c5b7=_0x209c08[0x0]['id'],_0xcdde06=_0x209c08[0x0][_0x5f343a(0x2f0)],_0x1163be=_0x5f343a(0x287)+_0x1de42f;if(_0x1de42f==0x5){var _0x3ed061=_0x1bbb03-_0x41e147;_0x1163be=_0x1163be+_0x5f343a(0x20c)+db[_0x5f343a(0x203)](_0x1bbb03)+'\x20,\x20total_time\x20=\x20'+db[_0x5f343a(0x203)](_0x3ed061);}_0x1163be=_0x1163be+_0x5f343a(0x2fb)+db['escape'](_0x27b635),db[_0x5f343a(0x1b3)](_0x1163be,function(_0x1504a0,_0x4b5987,_0x4aa9a0){});var _0x5e4665;_0x352b8b==_0x3a519c&&(_0x5e4665=_0x2c3512),_0x2c3512==_0x3a519c&&(_0x5e4665=_0x352b8b),db['query'](_0x5f343a(0x1a7)+db[_0x5f343a(0x203)](_0x5e4665),function(_0x194de9,_0x443406,_0x105dd9){var _0x2075fe=_0x5f343a;if(_0x194de9)throw _0x194de9;if(_0x443406){io['to'](_0x443406[0x0][_0x2075fe(0x30c)])[_0x2075fe(0x1e1)](_0x2075fe(0x2af),{'id':_0x15c5b7,'status':_0x1de42f,'channelName':_0x3f929a,'uuid':_0x27b635});if(_0x1de42f==0x2){var _0x21bc05={'id':_0x15c5b7['toString'](),'callType':_0xcdde06['toString'](),'status':_0x1de42f['toString'](),'channelName':_0x3f929a['toString'](),'notification_type':_0x2075fe(0x2cc),'uuid':_0x27b635};if(_0x443406[0x0][_0x2075fe(0x1dc)]==0x1){var _0x13898b=_0x443406[0x0][_0x2075fe(0x316)];_0x21bc05[_0x2075fe(0x21c)]=_0x3d7d4c[_0x2075fe(0x201)],_0x21bc05[_0x2075fe(0x320)]='Call\x20Cancel',sendPushNotification(_0x13898b,_0x21bc05);}else{let _0x1549dd=_0x443406[0x0][_0x2075fe(0x1e0)];_0x1549dd&&sendIosVoipPushNotification(_0x1549dd,_0x21bc05);}}}});}}});}),_0x3d7d4c['on'](_0x3f89ec(0x2a1),async _0x5a2807=>{var _0x39a196=_0x3f89ec,_0x2bccc4=_0x3d7d4c[_0x39a196(0x201)];console[_0x39a196(0x1fb)](_0x39a196(0x23a));var _0x2467dc=_0x5a2807[_0x39a196(0x23b)],_0x44d6a6={'userId':_0x2467dc};await endLiveCallIfExist(_0x3d7d4c,_0x44d6a6);var _0x3437e4=Math[_0x39a196(0x293)](new Date()[_0x39a196(0x31f)]()/0x3e8),_0x2d57d2=await createToken(),_0x98e0aa=_0x2d57d2[_0x39a196(0x271)],_0x12a7bb=_0x2d57d2[_0x39a196(0x26c)],_0x282ad3=_0x39a196(0x2eb)+db[_0x39a196(0x203)](_0x2467dc)+','+db[_0x39a196(0x203)](_0x3437e4)+','+db[_0x39a196(0x203)](_0x98e0aa)+','+db[_0x39a196(0x203)](_0x12a7bb)+'\x20)',_0x44a1a3=await getDbData(_0x282ad3),_0x331059=_0x44a1a3[_0x39a196(0x1e5)];_0x3d7d4c[_0x39a196(0x248)](_0x331059),_0x3d7d4c[_0x39a196(0x1e1)]('goLiveConfirm',{'liveCallId':_0x331059,'localCallId':_0x5a2807[_0x39a196(0x1fc)],'channelName':_0x98e0aa,'token':_0x12a7bb});var _0x455b1a=STATUS_LIVE_CALL_USER_ROLE_SUPER_HOST;_0x282ad3=_0x39a196(0x1a5)+db['escape'](_0x331059)+','+db[_0x39a196(0x203)](_0x2467dc)+','+db[_0x39a196(0x203)](_0x455b1a)+','+db[_0x39a196(0x203)](_0x3437e4)+','+db[_0x39a196(0x203)](_0x2467dc)+'\x20)',await getDbData(_0x282ad3),db[_0x39a196(0x1b3)](_0x39a196(0x240)+db[_0x39a196(0x203)](_0x2467dc),function(_0x3fc6bd,_0x3f3ccf,_0x270c42){var _0x33f4e5=_0x39a196;if(_0x3f3ccf){if(_0x3f3ccf[_0x33f4e5(0x1e4)]){var _0x428f22=_0x3f3ccf[0x0][_0x33f4e5(0x2df)],_0x5438cb=STORAGE_URL+_0x33f4e5(0x29d)+_0x428f22;_0x428f22==null&&(_0x5438cb=null),db['query'](_0x33f4e5(0x2b1)+_0x2467dc,function(_0x19686f,_0x7e6753,_0x46a903){var _0x2be887=_0x33f4e5;_0x7e6753[_0x2be887(0x1e4)]&&_0x7e6753['forEach'](_0x8f2e33=>{var _0x4d81b3=_0x2be887,_0x4e184c=_0x8f2e33[_0x4d81b3(0x316)];if(_0x4e184c){var _0x4710a1={'title':_0x2bccc4+_0x4d81b3(0x2cf),'body':_0x2bccc4+_0x4d81b3(0x255),'notification_type':_0x4d81b3(0x2ad),'liveCallId':_0x331059[_0x4d81b3(0x300)](),'channelName':_0x98e0aa,'token':_0x12a7bb,'userImageUrl':_0x5438cb,'userId':_0x2467dc[_0x4d81b3(0x300)]()};sendPushNotification(_0x4e184c,_0x4710a1);}});});}}});}),_0x3d7d4c['on'](_0x3f89ec(0x321),async _0x52f98d=>{var _0x2e0f2b=_0x3f89ec,_0x1c095a=_0x3d7d4c['username'];console[_0x2e0f2b(0x1fb)](_0x2e0f2b(0x28f)),console[_0x2e0f2b(0x1fb)](_0x52f98d);var _0x4b2b7b=_0x52f98d['userId'],_0x31cc3a=_0x52f98d[_0x2e0f2b(0x2e9)],_0x1ef4ba=_0x52f98d[_0x2e0f2b(0x308)],_0xda44e6=Math[_0x2e0f2b(0x293)](new Date()[_0x2e0f2b(0x31f)]()/0x3e8),_0x525a5e='SELECT\x20*\x20FROM\x20user\x20where\x20\x20id\x20='+db['escape'](_0x4b2b7b),_0x45f2a8=await getDbData(_0x525a5e),_0xa46e37=_0x45f2a8[0x0][_0x2e0f2b(0x30c)],_0x525a5e='SELECT\x20\x20*\x20from\x20user_live_history\x20where\x20status=\x20'+STATUS_LIVE_CALL_ONGOING+_0x2e0f2b(0x210)+_0x4b2b7b,_0x2e8f63=await getDbData(_0x525a5e);if(_0x2e8f63['length'])return console[_0x2e0f2b(0x1fb)](_0x2e0f2b(0x2d2)),_0x3d7d4c[_0x2e0f2b(0x1e1)](_0x2e0f2b(0x2d2),{'liveCallId':_0x2e8f63[0x0]['id']}),![];var _0x525a5e=_0x2e0f2b(0x1c5)+STATUS_LIVE_CALL_BATTLE_ONGOING+_0x2e0f2b(0x1d8)+_0x4b2b7b,_0x501746=await getDbData(_0x525a5e);if(_0x501746[_0x2e0f2b(0x1e4)])return console['log'](_0x2e0f2b(0x1c6)),_0x3d7d4c[_0x2e0f2b(0x1e1)](_0x2e0f2b(0x2d2),{'liveCallId':_0x2e8f63[0x0][_0x2e0f2b(0x1eb)],'battleId':_0x2e8f63[0x0]['id']}),![];var _0x525a5e=_0x2e0f2b(0x252)+_0x31cc3a+_0x2e0f2b(0x1d8)+_0x4b2b7b,_0x66345e=await getDbData(_0x525a5e);if(_0x66345e['length']){if(_0x66345e[0x0]['status']==STATUS_LIVE_CALL_BATTLE_PENDING){var _0x525a5e=_0x2e0f2b(0x1cc)+STATUS_LIVE_CALL_BATTLE_CANCELLED+_0x2e0f2b(0x2b2)+db[_0x2e0f2b(0x203)](_0x66345e[0x0]['id']);await getDbData(_0x525a5e),console[_0x2e0f2b(0x1fb)](_0x2e0f2b(0x21b));}}var _0x525a5e=_0x2e0f2b(0x2e4)+db['escape'](_0x31cc3a),_0xf44ff1=await getDbData(_0x525a5e);if(_0xf44ff1){var _0x41ed51=_0xf44ff1[0x0],_0x3b9653=_0x41ed51[_0x2e0f2b(0x31e)],_0x2a191d=_0x41ed51[_0x2e0f2b(0x26c)],_0x525a5e=_0x2e0f2b(0x25c)+db[_0x2e0f2b(0x203)](_0x31cc3a)+','+db[_0x2e0f2b(0x203)](_0x3d7d4c[_0x2e0f2b(0x23b)])+','+db[_0x2e0f2b(0x203)](_0x4b2b7b)+','+db[_0x2e0f2b(0x203)](_0x1ef4ba)+','+db[_0x2e0f2b(0x203)](_0xda44e6)+','+STATUS_LIVE_CALL_BATTLE_PENDING+')',_0x36dcb3=await getDbData(_0x525a5e),_0x32bd57=_0x36dcb3[_0x2e0f2b(0x1e5)];_0x3d7d4c[_0x2e0f2b(0x1e1)](_0x2e0f2b(0x1b7),{'liveCallId':_0x31cc3a,'battleId':_0x32bd57,'status':STATUS_LIVE_CALL_BATTLE_PENDING,'totalAllowedTime':_0x1ef4ba});var _0x525a5e='SELECT\x20*\x20FROM\x20user\x20where\x20\x20id\x20='+db[_0x2e0f2b(0x203)](_0x3d7d4c[_0x2e0f2b(0x23b)]),_0x36cbe7=await getDbData(_0x525a5e),_0x17ca70=_0x36cbe7[0x0][_0x2e0f2b(0x2df)];_0x17ca70==null&&(_0x17ca70=_0x2e0f2b(0x2f3));var _0x34cd2b=STORAGE_URL+_0x2e0f2b(0x29d)+_0x17ca70;_0x17ca70==null&&(_0x34cd2b=null);var _0xa46e37=_0x45f2a8[0x0]['socket_id'],_0x932ffe={'liveCallId':_0x31cc3a,'battleId':_0x32bd57},_0x57d39d=await getBattleDetail(_0x932ffe),_0x2d6a41={'liveCallId':_0x31cc3a,'battleId':_0x32bd57,'battleInfo':_0x57d39d,'userId':_0x3d7d4c[_0x2e0f2b(0x23b)],'username':_0x3d7d4c[_0x2e0f2b(0x201)],'channelName':_0x3b9653,'token':_0x2a191d,'userImageUrl':_0x34cd2b};io['to'](_0xa46e37)[_0x2e0f2b(0x1e1)](_0x2e0f2b(0x2a9),_0x2d6a41);}}),_0x3d7d4c['on'](_0x3f89ec(0x251),async _0x3fec35=>{var _0x2cab3e=_0x3f89ec,_0x577244=_0x3d7d4c[_0x2cab3e(0x201)];console[_0x2cab3e(0x1fb)]('reply\x20of\x20invitation\x20for\x20live\x20battle'),console['log'](_0x3fec35);var _0x5ea02a=_0x3d7d4c[_0x2cab3e(0x23b)],_0x170f94=_0x3fec35[_0x2cab3e(0x1e3)],_0x57fa95=_0x3fec35[_0x2cab3e(0x229)],_0x27418c=Math[_0x2cab3e(0x293)](new Date()[_0x2cab3e(0x31f)]()/0x3e8),_0x4a0759=_0x2cab3e(0x225)+_0x170f94,_0x19ceb7=await getDbData(_0x4a0759);if(_0x19ceb7[_0x2cab3e(0x1e4)]==0x0)return console[_0x2cab3e(0x1fb)](_0x2cab3e(0x1f9)),![];var _0x113b76=_0x19ceb7[0x0];if(_0x113b76[_0x2cab3e(0x229)]!=STATUS_LIVE_CALL_BATTLE_PENDING)return console['log'](_0x2cab3e(0x31a)),_0x3d7d4c[_0x2cab3e(0x1e1)](_0x2cab3e(0x261),{'battleId':_0x170f94}),![];var _0x38f497=_0x113b76[_0x2cab3e(0x1eb)],_0x4a0759=_0x2cab3e(0x1b9)+_0x38f497,_0x15eecf=await getDbData(_0x4a0759),_0x3602fc=_0x15eecf[0x0];console['log'](_0x3602fc);if(_0x3602fc[_0x2cab3e(0x229)]!=STATUS_LIVE_CALL_ONGOING)return console[_0x2cab3e(0x1fb)](_0x2cab3e(0x2be)),![];if(_0x57fa95==STATUS_LIVE_CALL_BATTLE_REJECTED){var _0x4a0759=_0x2cab3e(0x1cc)+STATUS_LIVE_CALL_BATTLE_REJECTED+'\x20where\x20id\x20=\x20'+db[_0x2cab3e(0x203)](_0x170f94),_0x1a31aa=await getDbData(_0x4a0759),_0x4a0759=_0x2cab3e(0x2d5)+_0x3602fc[_0x2cab3e(0x2e7)],_0x5efd0b=await getDbData(_0x4a0759),_0x2cab4b=_0x5efd0b[0x0][_0x2cab3e(0x30c)],_0x1b7e0c={'liveCallId':_0x38f497,'battleId':_0x170f94,'userId':_0x5ea02a,'username':_0x3d7d4c[_0x2cab3e(0x201)],'status':_0x57fa95};return io['to'](_0x2cab4b)[_0x2cab3e(0x1e1)](_0x2cab3e(0x2b8),_0x1b7e0c),console[_0x2cab3e(0x1fb)](_0x2cab3e(0x196)),console[_0x2cab3e(0x1fb)](_0x1b7e0c),![];}else{if(_0x57fa95==STATUS_LIVE_CALL_BATTLE_ACCEPTED){console[_0x2cab3e(0x1fb)](_0x2cab3e(0x1b8));var _0x4a0759=_0x2cab3e(0x1cc)+STATUS_LIVE_CALL_BATTLE_ONGOING+_0x2cab3e(0x317)+_0x27418c+_0x2cab3e(0x2b2)+db[_0x2cab3e(0x203)](_0x170f94);await getDbData(_0x4a0759);var _0x4a0759=_0x2cab3e(0x22f)+_0x3602fc[_0x2cab3e(0x2e7)],_0x5efd0b=await getDbData(_0x4a0759),_0x2cab4b=_0x5efd0b[0x0][_0x2cab3e(0x30c)],_0x4b6a13={'liveCallId':_0x38f497},_0x5928c1=await getLiveBattleInfo(_0x4b6a13);io['to'](_0x38f497)[_0x2cab3e(0x1e1)](_0x2cab3e(0x2b8),{'liveCallId':_0x38f497,'battleId':_0x170f94,'userId':_0x5ea02a,'username':_0x3d7d4c[_0x2cab3e(0x201)],'status':STATUS_LIVE_CALL_BATTLE_ONGOING,'battleInfo':_0x5928c1}),console[_0x2cab3e(0x1fb)]('reply\x20battle\x20:\x20liveBattleInvitationUpated'),console[_0x2cab3e(0x1fb)](_0x2cab3e(0x2a7)),_0x3d7d4c['join'](_0x38f497),io['to'](_0x38f497)[_0x2cab3e(0x1e1)](_0x2cab3e(0x2ed),{'liveCallId':_0x38f497,'battleId':_0x170f94,'battleInfo':_0x5928c1});var _0x4a0759=_0x2cab3e(0x22f)+_0x5ea02a,_0x375943=await getDbData(_0x4a0759);if(_0x375943[_0x2cab3e(0x1e4)]){var _0x362c80=_0x375943[0x0][_0x2cab3e(0x2df)];_0x362c80==null&&(_0x362c80=_0x2cab3e(0x2f3));var _0x14dd09=STORAGE_URL+_0x2cab3e(0x29d)+_0x362c80;_0x362c80==null&&(_0x14dd09=null);var _0x2279e6=_0x3602fc['channel_name'],_0x54b8d9=_0x3602fc[_0x2cab3e(0x26c)];db[_0x2cab3e(0x1b3)]('SELECT\x20\x20user.id,user.username,user.socket_id,user.device_token\x20FROM\x20follower\x20left\x20join\x20user\x20on\x20follower.follower_id\x20=\x20user.id\x20where\x20follower.user_id\x20='+_0x5ea02a,function(_0x3ad2c2,_0x332cec,_0x484e9c){var _0x28feab=_0x2cab3e;_0x332cec[_0x28feab(0x1e4)]&&_0x332cec[_0x28feab(0x2da)](_0x3bfccb=>{var _0x3f38da=_0x28feab,_0x3ea94e=_0x3bfccb[_0x3f38da(0x316)];if(_0x3ea94e){var _0x2e65dd={'title':_0x577244+_0x3f38da(0x270),'body':_0x577244+_0x3f38da(0x220),'notification_type':_0x3f38da(0x1b4),'liveCallId':_0x38f497[_0x3f38da(0x300)](),'channelName':_0x2279e6,'token':_0x54b8d9,'userImageUrl':_0x14dd09,'userId':_0x5ea02a[_0x3f38da(0x300)]()};sendPushNotification(_0x3ea94e,_0x2e65dd);}});});}}}}),_0x3d7d4c['on']('goLive_OLD',async _0x1c276b=>{var _0x183678=_0x3f89ec,_0xbd77c9=_0x3d7d4c[_0x183678(0x201)];console[_0x183678(0x1fb)](_0x183678(0x277));var _0x503c86=_0x1c276b[_0x183678(0x23b)],_0x4736bd=Math[_0x183678(0x293)](new Date()[_0x183678(0x31f)]()/0x3e8);db['query'](_0x183678(0x28d)+STATUS_LIVE_CALL_ONGOING+'\x20and\x20user_id\x20='+_0x503c86,async function(_0x33d3ae,_0x3634c1,_0x2eb671){var _0x4b60dd=_0x183678;if(_0x3634c1[_0x4b60dd(0x1e4)])console[_0x4b60dd(0x1fb)](_0x4b60dd(0x1ad),_0x3634c1[0x0]['id']),_0x3d7d4c[_0x4b60dd(0x1e1)](_0x4b60dd(0x2d2),{'liveCallId':_0x3634c1[0x0]['id']});else{var _0x42185e=await createToken(),_0x2f1eb8=_0x42185e['channelName'],_0x120971=_0x42185e['token'],_0x59a513=_0x4b60dd(0x2eb)+db['escape'](_0x503c86)+','+db[_0x4b60dd(0x203)](_0x4736bd)+','+db['escape'](_0x2f1eb8)+','+db['escape'](_0x120971)+'\x20)';db['query'](_0x59a513,function(_0x375a27,_0x2e52c1){var _0x4da59a=_0x4b60dd;if(_0x375a27)throw _0x375a27;var _0x52b66a=_0x2e52c1[_0x4da59a(0x1e5)];console['log'](_0x52b66a),_0x3d7d4c[_0x4da59a(0x248)](_0x52b66a),_0x3d7d4c['emit']('goLiveConfirm',{'liveCallId':_0x52b66a,'localCallId':_0x1c276b[_0x4da59a(0x1fc)],'channelName':_0x2f1eb8,'token':_0x120971}),db['query'](_0x4da59a(0x240)+db[_0x4da59a(0x203)](_0x503c86),function(_0x413116,_0x5a3b4b,_0x1ff97f){var _0x52b97e=_0x4da59a;if(_0x5a3b4b){if(_0x5a3b4b[_0x52b97e(0x1e4)]){var _0x1bb10e=_0x5a3b4b[0x0][_0x52b97e(0x2df)];_0x1bb10e==null&&(_0x1bb10e=_0x52b97e(0x2f3));var _0xd0671=STORAGE_URL+'/user/'+_0x1bb10e;_0x1bb10e==null&&(_0xd0671=null),db[_0x52b97e(0x1b3)]('SELECT\x20\x20user.id,user.username,user.socket_id,user.device_token\x20FROM\x20follower\x20left\x20join\x20user\x20on\x20follower.follower_id\x20=\x20user.id\x20where\x20follower.user_id\x20='+_0x503c86,function(_0x1a46a3,_0x25fccd,_0x524ab3){var _0x5deee8=_0x52b97e;_0x25fccd['length']&&_0x25fccd[_0x5deee8(0x2da)](_0x2260d8=>{var _0x57446a=_0x5deee8,_0x249226=_0x2260d8[_0x57446a(0x316)];if(_0x249226){var _0x1be5a3={'title':_0xbd77c9+_0x57446a(0x2cf),'body':_0xbd77c9+_0x57446a(0x255),'notification_type':_0x57446a(0x2ad),'liveCallId':_0x52b66a['toString'](),'channelName':_0x2f1eb8,'token':_0x120971,'userImageUrl':_0xd0671,'userId':_0x503c86[_0x57446a(0x300)]()};sendPushNotification(_0x249226,_0x1be5a3);}});});}}});});}});}),_0x3d7d4c['on'](_0x3f89ec(0x27c),_0x526f73=>{var _0x810bee=_0x3f89ec;console[_0x810bee(0x1fb)](_0x810bee(0x24f));var _0x24dd44=_0x526f73[_0x810bee(0x23b)],_0x378888={'userId':_0x24dd44};endLiveCallIfExist(_0x3d7d4c,_0x378888);}),_0x3d7d4c['on'](_0x3f89ec(0x2cb),async _0x2e16fc=>{var _0xc35836=_0x3f89ec;console[_0xc35836(0x1fb)]('leave\x20live\x20call');var _0x195c33=_0x2e16fc[_0xc35836(0x23b)],_0x533ed1=_0x2e16fc[_0xc35836(0x2e9)],_0x5f2549=_0xc35836(0x25b)+db[_0xc35836(0x203)](_0x533ed1)+_0xc35836(0x29f)+db['escape'](_0x195c33);getDbData(_0x5f2549);var _0xcb0f98={'liveCallId':_0x533ed1},_0x1cb71a=await getLiveCallUserCount(_0xcb0f98);_0x3d7d4c['to'](_0x533ed1)[_0xc35836(0x1e1)]('leaveUserLiveCall',{'username':_0x3d7d4c[_0xc35836(0x201)],'userId':_0x3d7d4c['userId'],'liveCallId':_0x533ed1,'totalUser':_0x1cb71a}),_0x3d7d4c[_0xc35836(0x310)](_0x533ed1);var _0x5f2549='delete\x20from\x20live_tv_viewer\x20\x20where\x20\x20live_call_id\x20='+db['escape'](_0x533ed1)+_0xc35836(0x29f)+db[_0xc35836(0x203)](_0x195c33);db[_0xc35836(0x1b3)](_0x5f2549,function(_0x1aec86,_0x36eee0,_0x1b5b32){});}),_0x3d7d4c['on'](_0x3f89ec(0x2ba),async _0x5bf385=>{var _0x23fe8c=_0x3f89ec,_0x12661d=_0x5bf385[_0x23fe8c(0x23b)],_0x562bab=_0x5bf385[_0x23fe8c(0x2e9)],_0x125231=Math[_0x23fe8c(0x293)](new Date()['getTime']()/0x3e8),_0x5b6db9=_0x23fe8c(0x262)+_0x562bab+'\x20and\x20user_id=\x20'+_0x12661d,_0x2668a8=await getDbData(_0x5b6db9);if(_0x2668a8[_0x23fe8c(0x1e4)]>0x0){var _0x2fc6c6=_0x2668a8[0x0];if(_0x2fc6c6[_0x23fe8c(0x286)]){var _0x2865c1=![];if(_0x2fc6c6[_0x23fe8c(0x2c9)]==STATUS_LIVE_CALL_BAN_TYPE_WHOLE_CALL)console[_0x23fe8c(0x1fb)](_0x23fe8c(0x304)),_0x2865c1=!![];else _0x2fc6c6['ban_type']==STATUS_LIVE_CALL_BAN_TYPE_TIME_PERIOD&&(_0x2fc6c6[_0x23fe8c(0x197)]>_0x125231&&(console[_0x23fe8c(0x1fb)](_0x23fe8c(0x2d6)+_0x2fc6c6[_0x23fe8c(0x197)]),_0x2865c1=!![]));if(_0x2865c1)return _0x3d7d4c[_0x23fe8c(0x1e1)](_0x23fe8c(0x29a),{'liveCallId':_0x562bab,'banType':_0x2fc6c6[_0x23fe8c(0x2c9)],'expelExpiryTime':_0x2fc6c6[_0x23fe8c(0x197)]}),![];}var _0x5b6db9=_0x23fe8c(0x1f1)+_0x2fc6c6['id'];await getDbData(_0x5b6db9);}console[_0x23fe8c(0x1fb)]('user\x20added\x20in\x20live\x20call'),_0x3d7d4c[_0x23fe8c(0x248)](_0x562bab);var _0x5f2815=STATUS_LIVE_CALL_USER_ROLE_USER;_0x5b6db9=_0x23fe8c(0x1a5)+db[_0x23fe8c(0x203)](_0x562bab)+','+db['escape'](_0x12661d)+','+db[_0x23fe8c(0x203)](_0x5f2815)+','+db[_0x23fe8c(0x203)](_0x125231)+','+db[_0x23fe8c(0x203)](_0x12661d)+'\x20)',await getDbData(_0x5b6db9);var _0x251e27={'liveCallId':_0x562bab},_0x2332cc=await getLiveCallUserCount(_0x251e27);io['to'](_0x562bab)[_0x23fe8c(0x1e1)](_0x23fe8c(0x2ba),{'username':_0x3d7d4c[_0x23fe8c(0x201)],'userId':_0x3d7d4c[_0x23fe8c(0x23b)],'liveCallId':_0x562bab,'totalUser':_0x2332cc});var _0x251e27={'liveCallId':_0x562bab},_0x5275a7=await getLiveBattleInfo(_0x251e27);_0x5275a7['liveBattleHosts'][_0x23fe8c(0x1e4)]>0x0&&_0x3d7d4c[_0x23fe8c(0x1e1)](_0x23fe8c(0x2ed),{'liveCallId':_0x562bab,'battleInfo':_0x5275a7});}),_0x3d7d4c['on'](_0x3f89ec(0x25d),_0x34f842=>{var _0x1bec99=_0x3f89ec;_0x34f842['username']=_0x3d7d4c[_0x1bec99(0x201)],_0x34f842[_0x1bec99(0x24b)]=Math[_0x1bec99(0x293)](new Date()['getTime']()/0x3e8),_0x34f842[_0x1bec99(0x298)]=_0x34f842['userId'];var _0x44beab=_0x34f842[_0x1bec99(0x2e9)];_0x3d7d4c['to'](_0x44beab)[_0x1bec99(0x1e1)]('sendMessageLiveCall',_0x34f842),_0x3d7d4c[_0x1bec99(0x1e1)](_0x1bec99(0x2b3),{'current_status':0x1,'localMessageId':_0x34f842[_0x1bec99(0x28b)],'liveCallId':_0x44beab,'created_at':_0x34f842[_0x1bec99(0x24b)]});}),_0x3d7d4c['on'](_0x3f89ec(0x2fd),async _0x4643dc=>{var _0x5dce61=_0x3f89ec;console[_0x5dce61(0x1fb)](_0x5dce61(0x2ee));var _0x1b7249=_0x4643dc[_0x5dce61(0x1e3)],_0x4ad68e=Math[_0x5dce61(0x293)](new Date()[_0x5dce61(0x31f)]()/0x3e8),_0x2f8d6a='SELECT\x20\x20*\x20from\x20user_live_battle\x20\x20where\x20id=\x20'+_0x1b7249,_0x327a0d=await getDbData(_0x2f8d6a);if(_0x327a0d['length']==0x0)return console[_0x5dce61(0x1fb)](_0x5dce61(0x1a4)),![];var _0x5e7ab6=_0x327a0d[0x0],_0x1b7249=_0x5e7ab6['id'],_0x32e07a=_0x5e7ab6[_0x5dce61(0x26e)],_0x2bf38c=_0x4ad68e-_0x32e07a,_0x32b325=_0x5e7ab6[_0x5dce61(0x1eb)],_0x28c30b=_0x5dce61(0x1cc)+STATUS_LIVE_CALL_BATTLE_COMPLETED+_0x5dce61(0x1c4)+db['escape'](_0x4ad68e)+_0x5dce61(0x1a3)+db[_0x5dce61(0x203)](_0x2bf38c)+_0x5dce61(0x2b2)+db['escape'](_0x1b7249);getDbData(_0x28c30b),io['to'](_0x32b325)['emit'](_0x5dce61(0x2fd),{'username':_0x3d7d4c['username'],'userId':_0x3d7d4c[_0x5dce61(0x23b)],'liveCallId':_0x32b325,'battleId':_0x1b7249});}),_0x3d7d4c['on']('sendGiftLiveCall',async _0x28bf72=>{var _0x33e8d1=_0x3f89ec;console[_0x33e8d1(0x1fb)](_0x33e8d1(0x243));var _0x55cf3f=_0x3d7d4c[_0x33e8d1(0x23b)],_0x103200=_0x28bf72[_0x33e8d1(0x23b)],_0x1a6c9b=_0x28bf72['liveCallId'],_0xfe813b=_0x28bf72[_0x33e8d1(0x1e3)],_0x39db73=_0x28bf72['giftId'],_0x4269e4=Math[_0x33e8d1(0x293)](new Date()[_0x33e8d1(0x31f)]()/0x3e8),_0x3fcf48='SELECT\x20\x20*\x20from\x20gift\x20\x20where\x20id=\x20'+_0x39db73,_0x3327e1=await getDbData(_0x3fcf48);if(_0x3327e1['length']==0x0)return console[_0x33e8d1(0x1fb)](_0x33e8d1(0x217)),![];var _0x43a8f9=_0x3327e1[0x0],_0x24e2b3=_0x43a8f9[_0x33e8d1(0x2b9)],_0x355cd2=_0x43a8f9['is_paid'],_0x3fcf48=_0x33e8d1(0x1c2)+_0x55cf3f,_0xc2edd4=await getDbData(_0x3fcf48),_0x11f5c5=_0xc2edd4[0x0],_0x5dbdcf=_0x11f5c5[_0x33e8d1(0x280)];_0x24e2b3>_0x5dbdcf&&_0x3d7d4c['emit']('notEnoughBalanceLiveCallGift',{'availableCoin':_0x5dbdcf,'gitCoin':_0x24e2b3});var _0x3fcf48='SELECT\x20*\x20FROM\x20setting',_0x12a0a1=await getDbData(_0x3fcf48),_0x40178a=_0x12a0a1[0x0],_0x433dc4=_0x40178a['available_coin'],_0x1816d1=_0x40178a[_0x33e8d1(0x1c9)],_0x4f1946=0x0;_0x1816d1>0x0&&(_0x4f1946=_0x24e2b3/0x64*_0x1816d1);var _0x292fbe=_0x24e2b3-_0x4f1946,_0x3fcf48;_0xfe813b>0x0?_0x3fcf48=_0x33e8d1(0x2d1)+db[_0x33e8d1(0x203)](_0x55cf3f)+','+db[_0x33e8d1(0x203)](_0x103200)+','+db['escape'](_0x39db73)+','+db['escape'](_0x292fbe)+','+db['escape'](_0x24e2b3)+','+db[_0x33e8d1(0x203)](0x1)+','+db[_0x33e8d1(0x203)](_0x1a6c9b)+','+db[_0x33e8d1(0x203)](_0xfe813b)+','+db[_0x33e8d1(0x203)](_0x4269e4)+'\x20)':_0x3fcf48=_0x33e8d1(0x27e)+db[_0x33e8d1(0x203)](_0x55cf3f)+','+db[_0x33e8d1(0x203)](_0x103200)+','+db[_0x33e8d1(0x203)](_0x39db73)+','+db[_0x33e8d1(0x203)](_0x292fbe)+','+db['escape'](_0x24e2b3)+','+db[_0x33e8d1(0x203)](0x1)+','+db[_0x33e8d1(0x203)](_0x1a6c9b)+','+db[_0x33e8d1(0x203)](_0x4269e4)+'\x20)';var _0x555b2c=await getDbData(_0x3fcf48),_0x392ce7=_0x555b2c['insertId'];if(_0x355cd2==0x1){if(_0x392ce7){var _0x22ad84=_0x5dbdcf-_0x24e2b3,_0x3fcf48=_0x33e8d1(0x193)+_0x22ad84+_0x33e8d1(0x2b2)+_0x55cf3f,_0x2572b2=await getDbData(_0x3fcf48);if(_0x2572b2){var _0x3c335c=0x2,_0x593c38=0x2,_0x130613=0x6,_0x12bff7=0x3,_0x3fcf48='INSERT\x20INTO\x20payment\x20(type,\x20user_id,\x20transaction_type,\x20payment_type,\x20payment_mode,\x20coin,\x20gift_history_id,created_at)\x20VALUES\x20('+db[_0x33e8d1(0x203)](_0x3c335c)+','+db[_0x33e8d1(0x203)](_0x55cf3f)+','+db[_0x33e8d1(0x203)](_0x593c38)+','+db[_0x33e8d1(0x203)](_0x130613)+','+db[_0x33e8d1(0x203)](_0x12bff7)+','+db['escape'](_0x24e2b3)+','+db[_0x33e8d1(0x203)](_0x392ce7)+','+db[_0x33e8d1(0x203)](_0x4269e4)+'\x20)',_0x555b2c=await getDbData(_0x3fcf48),_0x3fcf48=_0x33e8d1(0x312)+_0x103200,_0x14dab6=await getDbData(_0x3fcf48),_0x412c5e=_0x14dab6[0x0],_0x5dbdcf=_0x412c5e[_0x33e8d1(0x280)],_0x22ad84=_0x5dbdcf+_0x292fbe,_0x3fcf48=_0x33e8d1(0x193)+_0x22ad84+_0x33e8d1(0x2b2)+_0x103200,_0x2572b2=await getDbData(_0x3fcf48),_0x3c335c=0x2,_0x593c38=0x1,_0x130613=0x6,_0x12bff7=0x3,_0x3fcf48=_0x33e8d1(0x257)+db[_0x33e8d1(0x203)](_0x3c335c)+','+db[_0x33e8d1(0x203)](_0x103200)+','+db['escape'](_0x593c38)+','+db[_0x33e8d1(0x203)](_0x130613)+','+db[_0x33e8d1(0x203)](_0x12bff7)+','+db[_0x33e8d1(0x203)](_0x292fbe)+','+db[_0x33e8d1(0x203)](_0x392ce7)+','+db[_0x33e8d1(0x203)](_0x4269e4)+'\x20)',_0x555b2c=await getDbData(_0x3fcf48);if(_0x4f1946>0x0)var _0x5233fc=_0x433dc4+_0x4f1946,_0x3fcf48=_0x33e8d1(0x258)+_0x5233fc+'\x20where\x20id\x20=\x201',_0xa5c621=await getDbData(_0x3fcf48),_0x37a891=0x1,_0x3c335c=0x2,_0x593c38=0x1,_0x130613=0xd,_0x12bff7=0x3,_0x3fcf48=_0x33e8d1(0x257)+db[_0x33e8d1(0x203)](_0x3c335c)+','+db[_0x33e8d1(0x203)](_0x37a891)+','+db[_0x33e8d1(0x203)](_0x593c38)+','+db['escape'](_0x130613)+','+db[_0x33e8d1(0x203)](_0x12bff7)+','+db[_0x33e8d1(0x203)](_0x4f1946)+','+db[_0x33e8d1(0x203)](_0x392ce7)+','+db[_0x33e8d1(0x203)](_0x4269e4)+'\x20)',_0x555b2c=await getDbData(_0x3fcf48);}}}var _0x5bd239={'liveCallId':_0x1a6c9b,'battleId':_0xfe813b},_0xafbfba=await getLiveBattleInfo(_0x5bd239),_0x3f86f8=STORAGE_URL+'/gift/'+_0x43a8f9[_0x33e8d1(0x2df)],_0x1205eb=STORAGE_URL+'/user/'+_0x11f5c5[_0x33e8d1(0x2df)];_0x3f86f8==null&&(_0x1205eb=null),_0x28bf72['giftUrl']=_0x3f86f8,_0x28bf72[_0x33e8d1(0x1ac)]=_0x43a8f9[_0x33e8d1(0x1ac)],_0x28bf72[_0x33e8d1(0x2b9)]=_0x43a8f9[_0x33e8d1(0x2b9)],_0x28bf72['battleInfo']=_0xafbfba,_0x28bf72[_0x33e8d1(0x20e)]=_0x55cf3f,_0x28bf72['senderName']=_0x11f5c5['username'],_0x28bf72[_0x33e8d1(0x230)]=_0x1205eb,io['to'](_0x1a6c9b)[_0x33e8d1(0x1e1)](_0x33e8d1(0x2ff),_0x28bf72);}),_0x3d7d4c['on']('liveChatUpdateUserAction',async _0x210efd=>{var _0x2c01df=_0x3f89ec;console[_0x2c01df(0x1fb)](_0x2c01df(0x2e0));var _0x591b5b=_0x3d7d4c[_0x2c01df(0x23b)],_0x5ab972=_0x210efd[_0x2c01df(0x223)],_0x1b375f=_0x210efd[_0x2c01df(0x2e9)],_0x3dbe57=_0x210efd[_0x2c01df(0x306)],_0x58dc7d=_0x210efd[_0x2c01df(0x23d)],_0x40976b=_0x210efd['role'],_0x297db0=Math[_0x2c01df(0x293)](new Date()[_0x2c01df(0x31f)]()/0x3e8);if(_0x3dbe57==STATUS_LIVE_CALL_ACTION_TYPE_BAN){var _0x47a308=_0x2c01df(0x262)+_0x1b375f+_0x2c01df(0x2bf)+_0x5ab972,_0x13a1bf=await getDbData(_0x47a308);if(_0x13a1bf['length']>0x0){var _0x47a308,_0x2f1a77=0x1,_0x1ecadf=0x0;if(_0x58dc7d>0x0){var _0x2bd329=0x2;_0x1ecadf=_0x58dc7d+_0x297db0;}else{var _0x2bd329=0x1;_0x58dc7d=0x0,_0x1ecadf=0x0;}_0x47a308=_0x2c01df(0x21f)+db[_0x2c01df(0x203)](_0x2f1a77)+_0x2c01df(0x25e)+db['escape'](_0x2bd329)+_0x2c01df(0x206)+db[_0x2c01df(0x203)](_0x58dc7d)+',expel_expiry_time='+db[_0x2c01df(0x203)](_0x1ecadf)+_0x2c01df(0x191)+db[_0x2c01df(0x203)](_0x297db0)+_0x2c01df(0x237)+db[_0x2c01df(0x203)](_0x591b5b)+_0x2c01df(0x23f)+_0x13a1bf[0x0]['id'];var _0xac9b9f=await getDbData(_0x47a308);if(_0xac9b9f){_0x3d7d4c['emit']('liveChatUpdateUserActionConfirm',_0x210efd);var _0x47a308=_0x2c01df(0x2c4)+db[_0x2c01df(0x203)](_0x5ab972),_0x5452b4=await getDbData(_0x47a308);if(_0x5452b4){if(_0x5452b4[_0x2c01df(0x1e4)]){var _0x1540f9=_0x5452b4[0x0]['socket_id'],_0x1e32e9=io[_0x2c01df(0x2d0)][_0x2c01df(0x2d0)][_0x2c01df(0x1c7)](_0x1540f9),_0x5b688a={'liveCallId':_0x1b375f},_0x59602e=await getLiveCallUserCount(_0x5b688a);io['to'](_0x1b375f)[_0x2c01df(0x1e1)](_0x2c01df(0x2cb),{'username':_0x5452b4[0x0]['username'],'userId':_0x5ab972,'liveCallId':_0x1b375f,'totalUser':_0x59602e}),_0x1e32e9&&_0x1e32e9[_0x2c01df(0x310)](_0x1b375f);}}return![];}}}else{if(_0x3dbe57==STATUS_LIVE_CALL_ACTION_TYPE_UNBAN){var _0x47a308=_0x2c01df(0x262)+_0x1b375f+_0x2c01df(0x2bf)+_0x5ab972,_0x13a1bf=await getDbData(_0x47a308);if(_0x13a1bf[_0x2c01df(0x1e4)]){var _0x47a308=_0x2c01df(0x289)+_0x13a1bf[0x0]['id'],_0xac9b9f=await getDbData(_0x47a308);if(_0xac9b9f)return _0x3d7d4c['emit'](_0x2c01df(0x226),_0x210efd),![];}}else{if(_0x3dbe57==STATUS_LIVE_CALL_ACTION_TYPE_ROLE_UPDATE){var _0x47a308=_0x2c01df(0x262)+_0x1b375f+_0x2c01df(0x2bf)+_0x5ab972,_0x13a1bf=await getDbData(_0x47a308);if(_0x13a1bf['length']){var _0x47a308=_0x2c01df(0x1be)+db[_0x2c01df(0x203)](_0x40976b)+_0x2c01df(0x31c)+db['escape'](_0x5ab972)+_0x2c01df(0x2ec)+db[_0x2c01df(0x203)](_0x297db0)+_0x2c01df(0x237)+db[_0x2c01df(0x203)](_0x591b5b)+_0x2c01df(0x23f)+_0x13a1bf[0x0]['id'],_0xac9b9f=await getDbData(_0x47a308);if(_0xac9b9f)return _0x3d7d4c[_0x2c01df(0x1e1)](_0x2c01df(0x226),_0x210efd),_0x3d7d4c['to'](_0x1b375f)['emit'](_0x2c01df(0x2c5),_0x210efd),![];}}}}}),_0x3d7d4c['on'](_0x3f89ec(0x202),_0x305338=>{var _0x5adfb2=_0x3f89ec;console[_0x5adfb2(0x1fb)](_0x5adfb2(0x30e));var _0x3bdaf4=_0x305338[_0x5adfb2(0x23b)],_0x342a43=_0x305338[_0x5adfb2(0x1ed)];_0x3d7d4c[_0x5adfb2(0x248)](_0x342a43),_0x3d7d4c['to'](_0x342a43)[_0x5adfb2(0x1e1)](_0x5adfb2(0x202),{'username':_0x3d7d4c['username'],'userId':_0x3d7d4c[_0x5adfb2(0x23b)],'liveTvId':_0x342a43});const _0x4991f5=_0x342a43[_0x5adfb2(0x247)]('_');let _0x3cea7a=_0x4991f5[0x1];var _0x384ea8=Math['round'](new Date()[_0x5adfb2(0x31f)]()/0x3e8);db[_0x5adfb2(0x1b3)](_0x5adfb2(0x2b4)+db[_0x5adfb2(0x203)](_0x3cea7a)+'\x20and\x20user_id\x20='+db['escape'](_0x3bdaf4),function(_0x3a5756,_0x10d2d0,_0x185d19){var _0x17bc86=_0x5adfb2;if(_0x10d2d0[0x0][_0x17bc86(0x2d7)]==0x0){var _0x45759d=_0x17bc86(0x234)+db[_0x17bc86(0x203)](_0x3bdaf4)+','+db[_0x17bc86(0x203)](_0x3cea7a)+','+db[_0x17bc86(0x203)](_0x384ea8)+'\x20)';db[_0x17bc86(0x1b3)](_0x45759d,function(_0x3dcf09,_0x94170b){if(_0x3dcf09)throw _0x3dcf09;});}});}),_0x3d7d4c['on'](_0x3f89ec(0x2b0),_0x198e58=>{var _0x1cd5df=_0x3f89ec;console[_0x1cd5df(0x1fb)](_0x1cd5df(0x242));var _0x5c7d73=_0x198e58[_0x1cd5df(0x23b)],_0x11950f=_0x198e58[_0x1cd5df(0x1ed)];_0x3d7d4c['to'](_0x11950f)[_0x1cd5df(0x1e1)](_0x1cd5df(0x2b0),{'username':_0x3d7d4c[_0x1cd5df(0x201)],'userId':_0x3d7d4c['userId'],'liveTvId':_0x11950f}),_0x3d7d4c[_0x1cd5df(0x310)](_0x11950f);}),_0x3d7d4c['on'](_0x3f89ec(0x1de),_0x14fe90=>{var _0x3b4975=_0x3f89ec;_0x14fe90['username']=_0x3d7d4c[_0x3b4975(0x201)],_0x14fe90['created_at']=Math['round'](new Date()['getTime']()/0x3e8),_0x14fe90['created_by']=_0x14fe90[_0x3b4975(0x23b)];var _0x4203de=_0x14fe90['liveTvId'];_0x3d7d4c['to'](_0x4203de)[_0x3b4975(0x1e1)]('sendMessageLiveTv',_0x14fe90),_0x3d7d4c[_0x3b4975(0x1e1)]('updateMessageStatusLiveTv',{'current_status':0x1,'localMessageId':_0x14fe90[_0x3b4975(0x28b)],'liveTvId':_0x4203de,'created_at':_0x14fe90[_0x3b4975(0x24b)]});}),_0x3d7d4c['on'](_0x3f89ec(0x283),_0x41d323=>{var _0x151501=_0x3f89ec;console[_0x151501(0x1fb)](_0x151501(0x2c2));const _0xf469cb=_0x151501(0x28e),_0x3ae776={'data':{'score':'8520','time':_0x151501(0x281)},'token':_0xf469cb};admin[_0x151501(0x2bd)]()[_0x151501(0x1b6)](_0x3ae776)[_0x151501(0x246)](_0x521ce6=>{var _0x3e6ce3=_0x151501;console[_0x3e6ce3(0x1fb)](_0x3e6ce3(0x2f7),_0x521ce6);})[_0x151501(0x2c7)](_0x1ddfc0=>{var _0x5e3d96=_0x151501;console['log'](_0x5e3d96(0x1cf),_0x1ddfc0);});});});function getMessageBody(_0x5a27cb){var _0x4694f7=_0x192e67,_0x1c701c={},_0x36b573='';_0x1c701c[_0x4694f7(0x2c0)]='',_0x1c701c[_0x4694f7(0x2df)]='';var _0x130ea0=doDecrypt(_0x5a27cb['message']);console[_0x4694f7(0x1fb)](_0x130ea0);var _0x320041=_0x130ea0[_0x4694f7(0x2fa)];if(_0x320041==0x1)_0x1c701c[_0x4694f7(0x2c0)]=doDecrypt(_0x130ea0['text']);else{if(_0x320041==0x2)_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x215);else{if(_0x320041==0x3)_0x1c701c[_0x4694f7(0x2c0)]='Sent\x20a\x20video';else{if(_0x320041==0x4)_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x221);else{if(_0x320041==0x5)_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x2c3);else{if(_0x320041==0x6)_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x228);else{if(_0x320041==0x7)_0x1c701c['messageString']=_0x4694f7(0x314);else{if(_0x320041==0x8)_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x1b5);else{if(_0x320041==0xa)_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x278);else{if(_0x320041==0xb)_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x19f);else{if(_0x320041==0xc)_0x1c701c[_0x4694f7(0x2c0)]='Sent\x20a\x20story';else{if(_0x320041==0xd)_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x2c8);else{if(_0x320041==0xe)_0x1c701c['messageString']=_0x4694f7(0x1bb);else{if(_0x320041==0xf)_0x1c701c[_0x4694f7(0x2c0)]='Sent\x20a\x20group';else{if(_0x320041==0x10)_0x1c701c[_0x4694f7(0x2c0)]='Sent\x20a\x20file';else{if(_0x320041==0x11)_0x1c701c['messageString']='Replied\x20on\x20your\x20story';else{if(_0x320041==0x12)_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x20a);else{if(_0x320041==0x14)_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x194);else{if(_0x320041==0x64)_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x30a);else _0x320041==0xc8?_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x1fd):_0x1c701c[_0x4694f7(0x2c0)]=_0x4694f7(0x22c);}}}}}}}}}}}}}}}}}}return _0x1c701c;}function sendPushNotification(_0x23d2e7,_0xcb8e35){var _0x84f03a=_0x192e67;_0xcb8e35['userImageUrl']==null&&(_0xcb8e35[_0x84f03a(0x24d)]='');_0xcb8e35['userImage']==null&&(_0xcb8e35[_0x84f03a(0x25a)]='');_0xcb8e35[_0x84f03a(0x20f)]=_0x84f03a(0x238),_0xcb8e35[_0x84f03a(0x227)]=_0x84f03a(0x2fc),_0xcb8e35['priority']=_0x84f03a(0x267),console[_0x84f03a(0x1fb)](_0xcb8e35[_0x84f03a(0x320)]);var _0x59aaf0=_0xcb8e35[_0x84f03a(0x320)];_0x59aaf0=_0x59aaf0[_0x84f03a(0x300)]();_0x59aaf0[_0x84f03a(0x1e4)]>0x64&&(_0x59aaf0=_0x59aaf0[_0x84f03a(0x295)](0x0,0x64));_0xcb8e35[_0x84f03a(0x320)]=_0x59aaf0;var _0x567a98={'notification':{'title':_0xcb8e35['title'],'body':_0x59aaf0},'data':_0xcb8e35,'token':_0x23d2e7};console[_0x84f03a(0x1fb)](_0x567a98),admin[_0x84f03a(0x2bd)]()[_0x84f03a(0x1b6)](_0x567a98)[_0x84f03a(0x246)](_0x3d4364=>{var _0x41fdde=_0x84f03a;console[_0x41fdde(0x1fb)](_0x41fdde(0x2f7),_0x3d4364);})[_0x84f03a(0x2c7)](_0x480d6a=>{var _0xa661aa=_0x84f03a;console[_0xa661aa(0x1fb)](_0xa661aa(0x1cf),_0x480d6a);});}function sendIosVoipPushNotification(_0x3bcdf0,_0x2ec314){var _0x51160c=_0x192e67,_0x5284d6={'token':{'key':config[_0x51160c(0x2e2)][_0x51160c(0x2f5)],'keyId':config[_0x51160c(0x2e2)][_0x51160c(0x207)],'teamId':config[_0x51160c(0x2e2)][_0x51160c(0x199)]},'production':config[_0x51160c(0x2e2)]['production']},_0x3ca63f=new apn['Provider'](_0x5284d6),_0x44e6dc=new apn[(_0x51160c(0x192))]();_0x44e6dc[_0x51160c(0x21e)]=Math['floor'](Date[_0x51160c(0x311)]()/0x3e8)+0x3c,_0x44e6dc['badge']=0x1,_0x44e6dc['sound']='ping.aiff',_0x44e6dc[_0x51160c(0x26a)]='New\x20call',_0x44e6dc[_0x51160c(0x205)]=_0x2ec314,_0x44e6dc[_0x51160c(0x285)]=config[_0x51160c(0x2e2)][_0x51160c(0x21d)]+'.voip',_0x3ca63f[_0x51160c(0x1b6)](_0x44e6dc,_0x3bcdf0)[_0x51160c(0x246)]((_0x4be640,_0x2b1c23)=>{var _0x243431=_0x51160c;console['log'](_0x2b1c23),_0x4be640?console[_0x243431(0x1fb)](JSON[_0x243431(0x274)](_0x4be640)):console[_0x243431(0x1fb)](JSON[_0x243431(0x274)](_0x2b1c23));});}async function createToken(){var _0x3c9f5b=_0x192e67;let _0x3fab55='SELECT\x20*\x20FROM\x20setting';var _0x36edec=await getDbData(_0x3fab55),_0x35af66=uuidv4();const _0x15eb7e=_0x36edec[0x0][_0x3c9f5b(0x2a0)],_0xbe498=_0x36edec[0x0]['agora_app_certificate'],_0x21e75c=0x0,_0x557440='0',_0x231ded=RtcRole[_0x3c9f5b(0x31b)],_0x197797=0xe10,_0x1d687e=Math[_0x3c9f5b(0x2dd)](Date['now']()/0x3e8),_0x2662e4=_0x1d687e+_0x197797,_0x4fb6fc=RtcTokenBuilder[_0x3c9f5b(0x1ca)](_0x15eb7e,_0xbe498,_0x35af66,_0x21e75c,_0x231ded);return{'channelName':_0x35af66,'token':_0x4fb6fc};}function doEncrypt(_0x41f7c9){var _0x32daeb=_0x192e67;typeof _0x41f7c9=='object'&&(_0x41f7c9=JSON[_0x32daeb(0x274)](_0x41f7c9));var _0x1b6406=config[_0x32daeb(0x1c1)],_0x2e0198=crypto[_0x32daeb(0x29e)][_0x32daeb(0x2e8)](_0x41f7c9,_0x1b6406)[_0x32daeb(0x300)]();return _0x2e0198;}function doDecrypt(_0x2d2aeb){var _0x5dea4e=_0x192e67,_0xa55d70=config[_0x5dea4e(0x1c1)],_0x18a24d=crypto[_0x5dea4e(0x29e)][_0x5dea4e(0x1f0)](_0x2d2aeb,_0xa55d70)['toString'](crypto[_0x5dea4e(0x214)][_0x5dea4e(0x294)]);return isJsonString(_0x18a24d)&&(_0x18a24d=JSON[_0x5dea4e(0x23c)](_0x18a24d)),_0x18a24d;}function isJsonString(_0x16d23e){var _0x3d56ab=_0x192e67;try{JSON[_0x3d56ab(0x23c)](_0x16d23e);}catch(_0x48c4e1){return![];}return!![];}function getDbData(_0x24cde9){return new Promise((_0x39df98,_0x3f8a83)=>{var _0x57225b=_0x3fbd;db[_0x57225b(0x1b3)](_0x24cde9,function(_0x3d8ddc,_0x5199f3,_0x21dbad){if(_0x3d8ddc)return _0x3f8a83(_0x3d8ddc);return _0x39df98(_0x5199f3);});});}async function endLiveCallIfExist(_0x6b393c,_0x40219b){var _0x593778=_0x192e67;userId=_0x40219b[_0x593778(0x23b)];var _0x11908e=Math[_0x593778(0x293)](new Date()[_0x593778(0x31f)]()/0x3e8),_0x2da1d8=_0x593778(0x28d)+STATUS_LIVE_CALL_ONGOING+_0x593778(0x210)+userId,_0x160c11=await getDbData(_0x2da1d8);if(_0x160c11['length']){var _0x30d274=_0x160c11[0x0]['id'],_0x8959cd=_0x160c11[0x0][_0x593778(0x26e)],_0x38644a=_0x11908e-_0x8959cd,_0x311fe5='update\x20user_live_history\x20set\x20status='+STATUS_LIVE_CALL_COMPLETED+',\x20end_time\x20=\x20'+db['escape'](_0x11908e)+_0x593778(0x1a3)+db[_0x593778(0x203)](_0x38644a)+'\x20where\x20id\x20=\x20'+db[_0x593778(0x203)](_0x30d274);getDbData(_0x311fe5);var _0x2da1d8=_0x593778(0x1c5)+STATUS_LIVE_CALL_BATTLE_ONGOING+_0x593778(0x241)+userId,_0xdb3512=await getDbData(_0x2da1d8);_0xdb3512['length']&&_0xdb3512['forEach'](_0x36a96e=>{var _0x4990b3=_0x593778,_0x512b77=_0x36a96e['id'],_0x2cb8e8=_0x36a96e[_0x4990b3(0x26e)],_0x18e736=_0x11908e-_0x2cb8e8,_0x2e71ef=_0x4990b3(0x1cc)+STATUS_LIVE_CALL_BATTLE_COMPLETED+_0x4990b3(0x1c4)+db['escape'](_0x11908e)+_0x4990b3(0x1a3)+db['escape'](_0x18e736)+'\x20where\x20id\x20=\x20'+db[_0x4990b3(0x203)](_0x512b77);getDbData(_0x2e71ef);}),_0x6b393c['to'](_0x30d274)[_0x593778(0x1e1)](_0x593778(0x27c),{'liveCallId':_0x30d274,'userId':_0x6b393c[_0x593778(0x23b)],'username':_0x6b393c[_0x593778(0x201)]}),io['in'](_0x30d274)['socketsLeave'](_0x30d274);}var _0x2da1d8='SELECT\x20\x20*\x20from\x20user_live_battle\x20where\x20status=\x20'+STATUS_LIVE_CALL_BATTLE_ONGOING+_0x593778(0x1d8)+userId,_0xdb3512=await getDbData(_0x2da1d8);_0xdb3512[_0x593778(0x1e4)]&&_0xdb3512['forEach'](async _0x352241=>{var _0x4282c0=_0x593778,_0x45b640=_0x352241['id'],_0x1471f8=_0x352241[_0x4282c0(0x1eb)],_0x2a75b7=_0x352241[_0x4282c0(0x26e)],_0x19a818=_0x11908e-_0x2a75b7,_0x5e46f9='update\x20user_live_battle\x20set\x20status='+STATUS_LIVE_CALL_BATTLE_COMPLETED+',\x20end_time\x20=\x20'+db[_0x4282c0(0x203)](_0x11908e)+_0x4282c0(0x1a3)+db[_0x4282c0(0x203)](_0x19a818)+_0x4282c0(0x2b2)+db[_0x4282c0(0x203)](_0x45b640);getDbData(_0x5e46f9);var _0x3debfd={'liveCallId':_0x1471f8,'battleId':_0x45b640},_0x11e227=await getLiveBattleInfo(_0x3debfd);io['to'](_0x1471f8)['emit'](_0x4282c0(0x2ed),{'liveCallId':_0x1471f8,'battleId':_0x45b640,'battleInfo':_0x11e227});});}function _0x24f3(){var _0x2a814a=['listen','isSsl','seeen\x20message\x20sento\x20to','message','decode','deleteMessage_old','no\x20resultsLiveCall\x20Battle\x20','readMessage','log','localCallId','Send\x20a\x20gift','./serviceAccountKey.json','aHR0cHM6Ly9md2R0ZWNobm9sb2d5LmNvL2xpY2VuY2VfY2hlY2tlci9hcGkvd2ViL3YxL2xpY2VuY2Vz','host_user_id','username','addUserLiveTv','escape','SELECT\x20\x20user_live_battle.id\x20,\x20user_live_battle.super_host_user_id\x20,\x20user_live_battle.host_user_id,start_time,end_time,total_time,total_allowed_time\x20from\x20user_live_battle\x20\x20where\x20user_live_battle.status=\x20','payload',',total_expel_time=','keyId','express','SELECT\x20chat_message_user.id\x20as\x20chat_message_user_id,\x20chat_message_user.user_id,chat_message_user.chat_message_id,chat_message_user.status,\x20chat_message.local_message_id,\x20chat_message.room_id\x20FROM\x20chat_message_user\x20left\x20join\x20chat_message\x20on\x20chat_message.id\x20=\x20chat_message_user.chat_message_id\x20where\x20chat_message.created_by\x20=\x20','Reacted\x20on\x20your\x20story','SELECT\x20id,username,socket_id\x20FROM\x20user\x20where\x20id\x20=','\x20,\x20end_time\x20=\x20','3XKcAMT','senderId','sound','\x20and\x20user_id\x20=','socket.io','pushNotification','databaseURL','enc','Sent\x20an\x20image','SELECT\x20\x20count(live_call_viewer.id)\x20as\x20total_user,live_call_id\x20from\x20live_call_viewer\x20where\x20is_ban=0\x20and\x20live_call_viewer.live_call_id\x20=','No\x20gift\x20record\x20available','cert','SELECT\x20id,username,socket_id\x20FROM\x20user\x20where\x20id\x20IN(','warning','alreadyInviteUserInLiveBattleSent\x20and\x20cancelled\x20the\x20old\x20one\x20request','title','bundleId','expiry','UPDATE\x20live_call_viewer\x20set\x20is_ban=','\x20is\x20live\x20now\x20in\x20battle','Sent\x20and\x20audio','7wWwyNB','actionUserId','inner','SELECT\x20\x20*\x20from\x20user_live_battle\x20where\x20id=\x20','liveChatUpdateUserActionConfirm','content_available','Sent\x20a\x20stiker','status','Error:','update\x20chat_message_user\x20set\x20is_user_notify=\x27','Sent\x20a\x20message','charAt','_keyStr','SELECT\x20\x20*\x20from\x20user\x20where\x20id=\x20','senderImageUrl','callIncoming','type','chatAccessGroup','INSERT\x20INTO\x20live_tv_viewer\x20(user_id,\x20live_tv_id,created_at)\x20VALUES\x20(','ping.aiff','sender_socket_id',',updated_by=','default','\x27,is_chat_user_online=\x27','go\x20live\x20room\x20created\x20request','userId','parse','totalExpelTime','SELECT\x20sum(coin)\x20as\x20total_coin,\x20count(id)\x20as\x20total_gift\x20from\x20gift_history\x20where\x20gift_history.reciever_id\x20=','\x20where\x20id=\x20','SELECT\x20*\x20FROM\x20user\x20where\x20\x20\x20id\x20=','\x20and\x20super_host_user_id\x20=','leave\x20live\x20Tv','send\x20gift\x20to\x20live\x20user\x20call','badge','update\x20chat_message_user\x20set\x20status=\x27','then','split','join','address','http','created_at','database','userImageUrl','sslCertificatePath','end\x20\x20live\x20call','1049uUDhbC','replyLiveBattleInvitation','SELECT\x20\x20*\x20from\x20user_live_battle\x20where\x20user_live_history_id=\x20','chat_message_user_id','total_allowed_time','\x20is\x20live\x20now','\x27\x20\x20where\x20id\x20=\x20','INSERT\x20INTO\x20payment\x20(type,\x20user_id,\x20transaction_type,\x20payment_type,\x20payment_mode,\x20coin,\x20gift_history_id,created_at)\x20VALUES\x20(','update\x20setting\x20set\x20available_coin=','\x27,chat_last_time_online=\x27','userImage','delete\x20from\x20live_call_viewer\x20\x20where\x20\x20live_call_id\x20=','INSERT\x20INTO\x20user_live_battle\x20(user_live_history_id,super_host_user_id,host_user_id,\x20total_allowed_time,created_at,status)\x20VALUES\x20(','sendMessageLiveCall',',ban_type=','\x27\x20where\x20user_id\x20=\x20','SELECT\x20id,username,socket_id,device_token_voip_ios,device_token,device_type\x20FROM\x20user\x20where\x20id\x20=','alreadyStatusUpdatedLiveBattleInvitation','SELECT\x20\x20*\x20from\x20live_call_viewer\x20where\x20\x20live_call_id=\x20','INSERT\x20INTO\x20call_detail\x20(uuid,local_call_id,call_type,\x20caller_id,\x20receiver_id,\x20start_time,\x20channel_name)\x20VALUES\x20(','\x20and\x20user_live_battle.user_live_history_id\x20=','user_p_id','mysql2','high','read\x20message','sdfsjhfjsahfjshfjsd','alert','5843238bEIBtO','token','https','start_time','\x20and\x20user_id\x20=\x20','\x20is\x20live\x20in\x20battle','channelName','dev','delete_time','stringify','replace','\x20group\x20by\x20live_call_id','go\x20live\x20room\x20created','forword\x20the\x20message','36024Zfypbj','SELECT\x20*\x20FROM\x20call_detail\x20where\x20\x20\x20uuid\x20=','password','endLiveCall','user\x20disconnected\x20errrRRR','INSERT\x20INTO\x20gift_history\x20(sender_id,reciever_id,gift_id,coin,coin_actual,send_on_type,\x20live_call_id,created_at)\x20VALUES\x20(','user\x20disconnected','available_coin','2:43','listening\x20on\x20*:','sendNotificationTest','timeToEnd','topic','is_ban','update\x20call_detail\x20set\x20status=','\x20and\x20chat_message_user.status=','delete\x20\x20from\x20live_call_viewer\x20where\x20\x20id=\x20','total_coin','localMessageId','login','SELECT\x20\x20*\x20from\x20user_live_history\x20where\x20status=\x20','eUzWru_LqrDO28TPywKTj5:APA91bFKpKN6qy6q3IXgO8Mkxy7bf22CrUO7mqyddT_MwKXLw4YHkaGrxkU03e1suVMwSGlV4cn9ek8ziM7Y1Rkv-lz3x5ZymzbLg6FsbgAuSRvPOJGsnh9TEKWSVTQ-ZY8pOVqSHAl4','Invite\x20for\x20live\x20battle','warn','delete\x20from\x20live_tv_viewer\x20\x20where\x20user_id\x20=\x20','.voip','round','Utf8','substring','battleDetail','userOffline','created_by','update\x20chat_room_user\x20set\x20is_admin=0\x20where\x20user_id\x20=\x20','liveCallNotAllowed','\x27\x20where\x20id\x20IN(','totalOngoingTime','/user/','AES','\x20and\x20\x20user_id\x20=\x20','agora_api_key','goLive','\x20and\x20room_id\x20=','/index.html','\x20and\x20chat_message_user.is_user_notify=0\x20\x20and\x20chat_message_user.status\x20=','updateMessageCurrentStatusUser','push','accepted\x20and\x20ongoing\x20notitifcation','firebase-admin','newliveBattleInvitation','live','room_id','3574AbMMyP','101','28964309KEMLUf','callStatusUpdate','leaveUserLiveTv','SELECT\x20\x20user.id,user.username,user.socket_id,user.device_token\x20FROM\x20follower\x20left\x20join\x20user\x20on\x20follower.follower_id\x20=\x20user.id\x20where\x20follower.user_id\x20=','\x20where\x20id\x20=\x20','updateMessageStatusLiveCall','SELECT\x20count(id)\x20as\x20total\x20FROM\x20live_tv_viewer\x20where\x20\x20\x20live_tv_id\x20=','\x20and\x20chat_message.status\x20<>','103','callCreate','liveBattleInvitationUpated','coin','addUserLiveCall','port','total_gift','messaging','reply\x20battle\x20:\x20call\x20status\x20has\x20been\x20closed\x20now\x20','\x20and\x20user_id=\x20','messageString','Provider','typing','Sent\x20a\x20gif\x20file','SELECT\x20id,socket_id,username\x20FROM\x20user\x20where\x20\x20\x20id\x20=','liveChatUpdateUserActionUpdate','updateChatAccessGroup','catch','Sent\x20a\x20drawing','ban_type','error','leaveUserLiveCall','104','./config.json','79f2dd9dc247c30e1ab488bf352eb7c88eee0d519d1347fa99453e8ed2d5dcfd','\x20is\x20live','sockets','INSERT\x20INTO\x20gift_history\x20(sender_id,reciever_id,gift_id,coin,coin_actual,\x20send_on_type,\x20live_call_id,battle_id,created_at)\x20VALUES\x20(','alreadyLiveAnotherCall','data','\x20and\x20gift_history.battle_id\x20=','SELECT\x20\x20user.id,user.username,user.socket_id\x20from\x20user\x20where\x20id=\x20','you\x20are\x20not\x20allowed\x20to\x20enter\x20this\x20call\x20till\x20','total','INSERT\x20INTO\x20chat_message\x20(local_message_id,room_id,\x20type,\x20message,\x20replied_on_message,\x20is_encrypted,\x20chat_version,\x20created_by,\x20created_at,delete_time)\x20VALUES\x20(','fromCharCode','forEach','A\x20user\x20connected\x20:\x20','sendFile','floor','connection','image','udate\x20user\x20role/action\x20in\x20call','\x27\x20where\x20chat_message_id\x20=\x20','voipNotification','reciever\x20socket\x20not\x20\x20connected\x20and\x20send\x20push\x20notification','SELECT\x20*\x20FROM\x20user_live_history\x20where\x20\x20\x20id\x20=','delete\x20message','room','user_id','encrypt','liveCallId','&source_type=chat&au=iosappsworld&p=IkshidddddsdffliNjh2303&ip=','INSERT\x20INTO\x20user_live_history\x20(user_id,\x20start_time,channel_name,token)\x20VALUES\x20(',',is_ban=0,ban_type=0,total_expel_time=0,expel_expiry_time=0,\x20updated_at=','liveBattleHostUpdated','end\x20live\x20battle','deleteAfter','call_type','100','leftRoom','default.png','SELECT\x20user.id,user.username,\x20user.image\x20from\x20user\x20where\x20user.id\x20=','key','disconnect','Successfully\x20sent\x20message:','\x27,\x20is_user_notify=\x27','removeAllListeners','messageType','\x20where\x20uuid\x20=\x20','true','endLiveBattle','NOTUP','newGiftReceivedliveCall','toString','update\x20user\x20set\x20socket_id=\x27','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=','\x20and\x20status\x20=10','you\x20are\x20not\x20allowed\x20to\x20enter\x20this\x20call','makeRoomAdmin','actionType','baljit','totalAllowedTime','_utf8_encode','Group\x20action','left\x20room','socket_id','site_url','user\x20added\x20in\x20live\x20tv','chat_version','leave','now','SELECT\x20\x20user.id,user.username,user.socket_id,available_coin\x20from\x20user\x20where\x20id=\x20','receiver_id','Shared\x20the\x20contact','200','device_token',',start_time=','SELECT\x20\x20chat_room.type,chat_room_user.id,chat_room_user.status,chat_room_user.user_id,user.device_token,user.socket_id\x20FROM\x20chat_room_user\x20left\x20join\x20user\x20on\x20chat_room_user.user_id\x20=\x20user.id\x20left\x20join\x20chat_room\x20on\x20chat_room_user.room_id=chat_room.id\x20\x20where\x20chat_room_user.room_id\x20=','\x27\x20where\x20id\x20=','reply\x20battle\x20:\x20alreadyStatusUpdatedLiveBattleInvitation\x20','PUBLISHER',',\x20user_id\x20=\x20','replyCode','channel_name','getTime','body','inviteUserInLiveBattle','disconnect\x20fire','sdjfsjhflkasjfsdfkjsdftokenA',',\x20updated_at=','Notification','update\x20user\x20set\x20available_coin=','Reacted\x20on\x20your\x20message','createConnection','rejected\x20notitifcation','expel_expiry_time','user','teamId','local_message_id','createServer','125516pAgkRJ','crypto-js','New\x20call','Sent\x20a\x20\x20post','update\x20chat_room\x20set\x20chat_access_group=','charCodeAt','caller_id','\x20,\x20total_time\x20=\x20','No\x20battle\x20found','INSERT\x20INTO\x20live_call_viewer\x20(live_call_id,user_id,role,\x20created_at,created_by)\x20VALUES\x20(','hostname','SELECT\x20id,username,socket_id,device_type,device_token,device_token_voip_ios\x20FROM\x20user\x20where\x20id\x20=','host','SELECT\x20*\x20FROM\x20chat_room_user\x20where\x20user_id\x20=','readFileSync','addUser','name','already\x20live\x20call\x20id\x20','7456260SHOfvx','\x20and\x20\x20user_id\x20=','/agora-tokan','\x20where\x20\x20id\x20=\x20','agora-access-token','query','111','Shared\x20the\x20location','send','inviteUserInLiveBattleConfirm','reply\x20battle\x20:\x20accepted\x20call\x20','SELECT\x20\x20*\x20from\x20user_live_history\x20where\x20id=\x20','New\x20Call','Sent\x20a\x20profile','updateMessageCurrentStatus','\x27,is_user_notify=\x27','UPDATE\x20live_call_viewer\x20set\x20role=','9966249UCrary','\x20and\x20room_id\x20=\x20','encryptionKey','SELECT\x20\x20user.id,user.username,user.socket_id,available_coin,\x20user.image\x20from\x20user\x20where\x20id=\x20','deleteMessage',',\x20end_time\x20=\x20','SELECT\x20\x20*\x20from\x20user_live_battle\x20where\x20status=\x20','alreadyLiveAnotherCall\x20battle','get','recieverId','commission_on_gift','buildTokenWithUid','liveBattleHosts','update\x20user_live_battle\x20set\x20status=','notification_type','skjfksd.jpg','Error\x20sending\x20message:','SELECT\x20*\x20FROM\x20setting','removeUserFromRoom','sendMessage','SELECT\x20*\x20FROM\x20chat_message\x20where\x20\x20id\x20=','super_host_user_id','deleteScope','end','indexOf','\x20and\x20host_user_id\x20=','apn','removeRoomAdmin','reciever\x20socket\x20connected','device_type','DESKTOP-MRLV3Q3','sendMessageLiveTv','SELECT\x20chat_message_user.id,chat_message_user.status,chat_message_user.user_id,\x20chat_message_user.chat_message_id,user.socket_id\x20from\x20chat_message_user\x20left\x20join\x20user\x20on\x20chat_message_user.user_id\x20=\x20user.id\x20where\x20chat_message_id\x20=\x20','device_token_voip_ios','emit','chat_message_id','battleId','length','insertId','10dgScnU','is_encrypted','stack','uuid','update\x20chat_room_user\x20set\x20status=\x27','user_live_history_id','SELECT\x20chat_message_user.id\x20as\x20chat_message_user_id\x20,chat_message_user.chat_message_id,chat_message_user.status,\x20user.socket_id,\x20sender_user.id\x20as\x20sender_user_id,sender_user.username,\x20sender_user.socket_id\x20as\x20sender_socket_id,\x20chat_message.*\x20\x20\x20FROM\x20chat_message_user\x20left\x20join\x20chat_message\x20on\x20chat_message.id\x20=\x20chat_message_user.chat_message_id\x20LEFT\x20JOIN\x20user\x20on\x20chat_message_user.user_id\x20=\x20user.id\x20LEFT\x20JOIN\x20user\x20as\x20sender_user\x20on\x20chat_message.created_by\x20=\x20sender_user.id\x20\x20where\x20chat_message_user.user_id\x20=','liveTvId','performActionOnCall','replied_on_message','decrypt','delete\x20from\x20live_call_viewer\x20where\x20\x20id=\x20','userOnline'];_0x24f3=function(){return _0x2a814a;};return _0x24f3();}async function getLiveBattleInfo(_0xd118e){var _0x1f1111=_0x192e67,_0x53d2ff=_0xd118e[_0x1f1111(0x2e9)],_0x2dcc19={},_0x197e6e={},_0x22e242=[],_0x3430f5=_0x1f1111(0x204)+STATUS_LIVE_CALL_BATTLE_ONGOING+_0x1f1111(0x264)+_0x53d2ff,_0x82d6da=await getDbData(_0x3430f5);if(_0x82d6da[_0x1f1111(0x1e4)]){var _0x17b22c=_0x82d6da[0x0];_0x197e6e=_0x17b22c;let _0x180b73=Math['round'](new Date()[_0x1f1111(0x31f)]()/0x3e8);var _0x1f642e=_0x180b73-_0x197e6e[_0x1f1111(0x26e)];_0x197e6e[_0x1f1111(0x29c)]=_0x1f642e,_0x197e6e[_0x1f1111(0x284)]=_0x197e6e['total_allowed_time']-_0x1f642e;var _0x3430f5=_0x1f1111(0x2f4)+_0x17b22c[_0x1f1111(0x1d4)],_0x292734=await getDbData(_0x3430f5);if(_0x292734['length']){var _0x157975=_0x292734[0x0],_0x3430f5='SELECT\x20sum(coin)\x20as\x20total_coin,\x20count(id)\x20as\x20total_gift\x20from\x20gift_history\x20where\x20gift_history.reciever_id\x20='+_0x17b22c[_0x1f1111(0x1d4)]+_0x1f1111(0x2d4)+_0x17b22c['id'],_0x4f9b9b=await getDbData(_0x3430f5),_0x2d10d6=_0x4f9b9b[0x0];_0x157975[_0x1f1111(0x2df)]==null&&(_0x157975[_0x1f1111(0x2df)]='default.png');var _0x484c82=STORAGE_URL+_0x1f1111(0x29d)+_0x157975[_0x1f1111(0x2df)];_0x157975[_0x1f1111(0x2df)]==null&&(_0x484c82=null);var _0x350a8=Math[_0x1f1111(0x2dd)](_0x2d10d6['total_coin']),_0x461cc2={'userId':_0x157975['id'],'username':_0x157975[_0x1f1111(0x201)],'userImageUrl':_0x484c82,'liveCallId':_0x53d2ff,'battleId':_0x17b22c['id'],'isSuperHost':0x1,'totalCoin':_0x350a8,'totalGift':_0x2d10d6['total_gift']};_0x22e242[_0x1f1111(0x2a6)](_0x461cc2);}var _0x3430f5='SELECT\x20user.id,user.username,user.image\x20from\x20user\x20where\x20user.id\x20='+_0x17b22c[_0x1f1111(0x200)],_0x3e5a8=await getDbData(_0x3430f5);if(_0x3e5a8['length']){var _0x3430f5=_0x1f1111(0x23e)+_0x17b22c[_0x1f1111(0x200)]+'\x20and\x20gift_history.battle_id\x20='+_0x17b22c['id'],_0x4f9b9b=await getDbData(_0x3430f5),_0x2d10d6=_0x4f9b9b[0x0],_0x350a8=Math['floor'](_0x2d10d6[_0x1f1111(0x28a)]),_0x25fe76=_0x3e5a8[0x0];_0x25fe76[_0x1f1111(0x2df)]==null&&(_0x25fe76[_0x1f1111(0x2df)]=_0x1f1111(0x2f3));var _0x484c82=STORAGE_URL+_0x1f1111(0x29d)+_0x25fe76[_0x1f1111(0x2df)],_0x461cc2={'userId':_0x25fe76['id'],'username':_0x25fe76[_0x1f1111(0x201)],'userImageUrl':_0x484c82,'liveCallId':_0x53d2ff,'battleId':_0x17b22c['id'],'isSuperHost':0x0,'totalCoin':_0x350a8,'totalGift':_0x2d10d6[_0x1f1111(0x2bc)]};_0x22e242[_0x1f1111(0x2a6)](_0x461cc2);}}return _0x2dcc19[_0x1f1111(0x296)]=_0x197e6e,_0x2dcc19[_0x1f1111(0x1cb)]=_0x22e242,_0x2dcc19;}async function getBattleDetail(_0x34bcd5){var _0x2b9e0a=_0x192e67,_0x15a8a4=_0x34bcd5[_0x2b9e0a(0x1e3)],_0x38bec8=_0x34bcd5[_0x2b9e0a(0x2e9)],_0x307495={},_0x1190bd={},_0x3f0110=[],_0x11600f='SELECT\x20\x20user_live_battle.id\x20,\x20user_live_battle.super_host_user_id\x20,\x20user_live_battle.host_user_id,start_time,end_time,total_time,total_allowed_time,status\x20from\x20user_live_battle\x20\x20where\x20\x20user_live_battle.id\x20='+_0x15a8a4,_0xa20ab9=await getDbData(_0x11600f);if(_0xa20ab9[_0x2b9e0a(0x1e4)]){var _0x3d6b2e=_0xa20ab9[0x0];_0x1190bd=_0x3d6b2e;var _0x1fac94=0x0,_0x2414cc=0x0;if(_0x3d6b2e[_0x2b9e0a(0x229)]==STATUS_LIVE_CALL_BATTLE_ONGOING){let _0xcf84f5=Math[_0x2b9e0a(0x293)](new Date()[_0x2b9e0a(0x31f)]()/0x3e8);_0x1fac94=_0xcf84f5-_0x1190bd[_0x2b9e0a(0x26e)],_0x2414cc=_0x1190bd[_0x2b9e0a(0x254)]-_0x1fac94;}else _0x3d6b2e[_0x2b9e0a(0x229)]==STATUS_LIVE_CALL_BATTLE_PENDING&&(_0x1fac94=0x0,_0x2414cc=_0x1190bd[_0x2b9e0a(0x254)]);_0x1190bd[_0x2b9e0a(0x29c)]=_0x1fac94,_0x1190bd[_0x2b9e0a(0x284)]=_0x2414cc;var _0x11600f=_0x2b9e0a(0x2f4)+_0x3d6b2e[_0x2b9e0a(0x1d4)],_0x2c64dd=await getDbData(_0x11600f);if(_0x2c64dd['length']){var _0xd0a998=_0x2c64dd[0x0],_0x11600f=_0x2b9e0a(0x23e)+_0x3d6b2e[_0x2b9e0a(0x1d4)]+_0x2b9e0a(0x2d4)+_0x3d6b2e['id'],_0x489927=await getDbData(_0x11600f),_0x32f251=_0x489927[0x0];_0xd0a998[_0x2b9e0a(0x2df)]==null&&(_0xd0a998[_0x2b9e0a(0x2df)]=_0x2b9e0a(0x2f3));var _0x26d887=STORAGE_URL+'/user/'+_0xd0a998[_0x2b9e0a(0x2df)];_0xd0a998[_0x2b9e0a(0x2df)]==null&&(_0x26d887=null);var _0xb6ae39={'userId':_0xd0a998['id'],'username':_0xd0a998[_0x2b9e0a(0x201)],'userImageUrl':_0x26d887,'liveCallId':_0x38bec8,'battleId':_0x3d6b2e['id'],'isSuperHost':0x1,'totalCoin':_0x32f251['total_coin'],'totalGift':_0x32f251[_0x2b9e0a(0x2bc)]};_0x3f0110[_0x2b9e0a(0x2a6)](_0xb6ae39);}var _0x11600f=_0x2b9e0a(0x2f4)+_0x3d6b2e[_0x2b9e0a(0x200)],_0x4b5f91=await getDbData(_0x11600f);if(_0x4b5f91[_0x2b9e0a(0x1e4)]){var _0x11600f='SELECT\x20sum(coin)\x20as\x20total_coin,\x20count(id)\x20as\x20total_gift\x20from\x20gift_history\x20where\x20gift_history.reciever_id\x20='+_0x3d6b2e[_0x2b9e0a(0x200)]+_0x2b9e0a(0x2d4)+_0x3d6b2e['id'],_0x489927=await getDbData(_0x11600f),_0x32f251=_0x489927[0x0],_0x253cac=_0x4b5f91[0x0];_0x253cac[_0x2b9e0a(0x2df)]==null&&(_0x253cac[_0x2b9e0a(0x2df)]=_0x2b9e0a(0x2f3));var _0x26d887=STORAGE_URL+_0x2b9e0a(0x29d)+_0x253cac[_0x2b9e0a(0x2df)];_0x253cac[_0x2b9e0a(0x2df)]==null&&(_0x26d887=null);var _0xb6ae39={'userId':_0x253cac['id'],'username':_0x253cac[_0x2b9e0a(0x201)],'userImageUrl':_0x26d887,'liveCallId':_0x38bec8,'battleId':_0x3d6b2e['id'],'isSuperHost':0x0,'totalCoin':_0x32f251['total_coin'],'totalGift':_0x32f251[_0x2b9e0a(0x2bc)]};_0x3f0110[_0x2b9e0a(0x2a6)](_0xb6ae39);}}return _0x307495[_0x2b9e0a(0x296)]=_0x1190bd,_0x307495['liveBattleHosts']=_0x3f0110,_0x307495;}async function getLiveCallUserCount(_0x1befa5){var _0x50526b=_0x192e67,_0x346780=_0x1befa5[_0x50526b(0x2e9)],_0xac6097=_0x50526b(0x216)+_0x346780+_0x50526b(0x276),_0x52ad34=await getDbData(_0xac6097),_0x299153=0x0;return _0x52ad34[_0x50526b(0x1e4)]&&(_0x299153=_0x52ad34[0x0]['total_user']),_0x299153;}server[_0x192e67(0x1f3)](config[_0x192e67(0x2bb)],()=>{var _0x30d68b=_0x192e67;console['log'](_0x30d68b(0x282)+config[_0x30d68b(0x2bb)]);});